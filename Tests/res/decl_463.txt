syn_fn_def(
  name: fn_symbol(gen_prg_code),
  params: [(type: type_ref(type_symbol(program)), var: var(prg))],
  local_fns: [],
  expr: do_expr(
    [
      assignment_stmt(
        value: fn_call(
          name: fn_symbol(merge_fns_same_name_and_arity),
          params: [const_or_var(prg)],
          named_params: []
        ),
        var: var(simpl_prg)
      ),
      assignment_stmt(
        value: set_comp(
          sel_exprs: [],
          source: [
            in_clause(
              src: fn_call(
                name: fn_symbol(keys),
                params: [
                  accessor(expr: const_or_var(simpl_prg), field: object(tdefs))
                ],
                named_params: []
              ),
              ptrn: var_ptrn(name: var(tn))
            )
          ],
          expr: fn_call(
            name: fn_symbol(mk_named_type_memb_test_fn),
            params: [
              const_or_var(tn),
              accessor(expr: const_or_var(prg), field: object(tdefs))
            ],
            named_params: []
          )
        ),
        var: var(memb_tests)
      ),
      assignment_stmt(
        value: set_comp(
          sel_exprs: [],
          source: [
            in_clause(
              src: accessor(expr: const_or_var(simpl_prg), field: object(fndefs)),
              ptrn: var_ptrn(name: var(fd))
            )
          ],
          expr: fn_call(
            name: fn_symbol(gen_fn_code),
            params: [const_or_var(fd)],
            named_params: [
              syn_fn_def(
                name: fn_symbol(type_map),
                params: [],
                local_fns: [],
                expr: accessor(expr: const_or_var(simpl_prg), field: object(tdefs))
              )
            ]
          )
        ),
        var: var(fndefs)
      ),
      return_stmt(
        fn_call(
          name: op_symbol(amp),
          params: [const_or_var(memb_tests), const_or_var(fndefs)],
          named_params: []
        )
      )
    ]
  ),
  res_type: type_ref(type_symbol(any))
)
