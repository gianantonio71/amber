using_block(
  fn_defs: [
    syn_fn_def(
      name: fn_symbol(expr_wf_errors),
      params: [
        (type: type_ref(type_symbol(synexpr)), var: var(expr)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: set_expr({}),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(object)))
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(union),
                  params: [
                    set_comp(
                      sel_exprs: [],
                      source: [
                        in_clause(
                          src: fn_call(
                            name: fn_symbol(set),
                            params: [accessor(expr: const_or_var(expr), field: object(head))],
                            named_params: []
                          ),
                          ptrn: var_ptrn(name: var(e))
                        )
                      ],
                      expr: fn_call(
                        name: fn_symbol(expr_wf_errors),
                        params: [const_or_var(e), const_or_var(def_vars)],
                        named_params: []
                      )
                    )
                  ],
                  named_params: []
                ),
                if_expr(
                  else: set_expr({}),
                  branches: [
                    (
                      expr: fn_call(
                        name: fn_symbol(expr_wf_errors),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(tail)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      cond: accessor_test(expr: const_or_var(expr), field: object(tail))
                    )
                  ]
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(seq_expr)))
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(union),
              params: [
                set_comp(
                  sel_exprs: [],
                  source: [
                    in_clause(src: const_or_var(es), ptrn: var_ptrn(name: var(e)))
                  ],
                  expr: fn_call(
                    name: fn_symbol(expr_wf_errors),
                    params: [const_or_var(e), const_or_var(def_vars)],
                    named_params: []
                  )
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(es)),
                tag: obj_ptrn(object(set_expr))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(union),
              params: [
                set_comp(
                  sel_exprs: [],
                  source: [
                    in_clause(src: const_or_var(es), ptrn: var_ptrn(name: var(e))),
                    in_clause(
                      src: set_expr(
                        {
                          accessor(expr: const_or_var(e), field: object(value)),
                          accessor(expr: const_or_var(e), field: object(key)),
                          cond_expr(
                            expr: accessor(expr: const_or_var(e), field: object(cond)),
                            cond: accessor_test(expr: const_or_var(e), field: object(cond))
                          )
                        }
                      ),
                      ptrn: var_ptrn(name: var(se))
                    )
                  ],
                  expr: fn_call(
                    name: fn_symbol(expr_wf_errors),
                    params: [const_or_var(se), const_or_var(def_vars)],
                    named_params: []
                  )
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(es)),
                tag: obj_ptrn(object(map_expr))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(tag)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(obj)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(tag_obj_expr))
              )
            ]
          ),
          case(
            expr: set_expr(
              {
                cond_expr(
                  expr: tag_obj_expr(obj: const_or_var(expr), tag: object(undef_var)),
                  cond: not(
                    fn_call(
                      name: fn_symbol(in),
                      params: [const_or_var(expr), const_or_var(def_vars)],
                      named_params: []
                    )
                  )
                )
              }
            ),
            patterns: [type_ptrn(type_ref(type_symbol(var)))]
          ),
          case(
            expr: do_expr(
              [
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: or(
                        left: fn_call(
                          name: fn_symbol(in),
                          params: [
                            tag_obj_expr(obj: const_or_var(a), tag: object(var)),
                            const_or_var(def_vars)
                          ],
                          named_params: []
                        ),
                        right: fn_call(
                          name: fn_symbol(is_def),
                          params: [
                            tag_obj_expr(obj: const_or_var(a), tag: object(fn_symbol)),
                            object(0),
                            const_or_var(fns_in_scope),
                            const_or_var(impl_params)
                          ],
                          named_params: []
                        )
                      ),
                      body: [return_stmt(set_expr({}))]
                    )
                  ]
                ),
                return_stmt(
                  if_expr(
                    else: set_expr(
                      {
                        tag_obj_expr(obj: const_or_var(a), tag: object(undef_var_or_const))
                      }
                    ),
                    branches: [
                      (
                        expr: set_expr(
                          {
                            tag_obj_expr(obj: const_or_var(a), tag: object(almost_def_const))
                          }
                        ),
                        cond: fn_call(
                          name: fn_symbol(is_almost_def),
                          params: [
                            tag_obj_expr(obj: const_or_var(a), tag: object(fn_symbol)),
                            object(0),
                            const_or_var(fns_in_scope)
                          ],
                          named_params: []
                        )
                      )
                    ]
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(a)),
                tag: obj_ptrn(object(const_or_var))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(impl_params),
                      set_comp(
                        sel_exprs: [],
                        source: [
                          in_clause(
                            src: fn_call(
                              name: fn_symbol(set),
                              params: [
                                accessor(expr: const_or_var(expr), field: object(named_params))
                              ],
                              named_params: []
                            ),
                            ptrn: var_ptrn(name: var(fd))
                          )
                        ],
                        expr: fn_call(
                          name: fn_symbol(untyped_sgn),
                          params: [const_or_var(fd)],
                          named_params: []
                        )
                      )
                    ],
                    named_params: []
                  ),
                  var: var(ips)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(exprs_wf_errors),
                    params: [
                      accessor(expr: const_or_var(expr), field: object(params)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(errs)
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: not(
                        fn_call(
                          name: fn_symbol(is_def),
                          params: [
                            accessor(expr: const_or_var(expr), field: object(name)),
                            fn_call(
                              name: fn_symbol(length),
                              params: [accessor(expr: const_or_var(expr), field: object(params))],
                              named_params: []
                            ),
                            const_or_var(fns_in_scope),
                            const_or_var(ips)
                          ],
                          named_params: []
                        )
                      ),
                      body: [
                        assignment_stmt(
                          value: map_expr(
                            {
                              (
                                value: accessor(expr: const_or_var(expr), field: object(name)),
                                key: object(name)
                              ),
                              (
                                value: fn_call(
                                  name: fn_symbol(length),
                                  params: [accessor(expr: const_or_var(expr), field: object(params))],
                                  named_params: []
                                ),
                                key: object(arity)
                              )
                            }
                          ),
                          var: var(err_info)
                        ),
                        assignment_stmt(
                          value: fn_call(
                            name: fn_symbol(is_almost_def),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(name)),
                              fn_call(
                                name: fn_symbol(length),
                                params: [accessor(expr: const_or_var(expr), field: object(params))],
                                named_params: []
                              ),
                              const_or_var(fns_in_scope)
                            ],
                            named_params: []
                          ),
                          var: var(almost_def)
                        ),
                        assignment_stmt(
                          value: fn_call(
                            name: op_symbol(amp),
                            params: [
                              const_or_var(errs),
                              set_expr(
                                {
                                  if_expr(
                                    else: tag_obj_expr(obj: const_or_var(err_info), tag: object(undef_fn)),
                                    branches: [
                                      (
                                        expr: tag_obj_expr(obj: const_or_var(err_info), tag: object(almost_def_fn)),
                                        cond: const_or_var(almost_def)
                                      )
                                    ]
                                  )
                                }
                              )
                            ],
                            named_params: []
                          ),
                          var: var(errs)
                        )
                      ]
                    )
                  ]
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(fndefs_wf_errors),
                    params: [
                      fn_call(
                        name: fn_symbol(set),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(named_params))
                        ],
                        named_params: []
                      ),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(np_errs)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [const_or_var(errs), const_or_var(np_errs)],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(fn_call)))
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(exprs_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(params)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                set_expr(
                  {
                    cond_expr(
                      expr: tag_obj_expr(
                        obj: map_expr(
                          {
                            (
                              value: accessor(expr: const_or_var(expr), field: object(name)),
                              key: object(name)
                            ),
                            (
                              value: fn_call(
                                name: fn_symbol(length),
                                params: [accessor(expr: const_or_var(expr), field: object(params))],
                                named_params: []
                              ),
                              key: object(arity)
                            )
                          }
                        ),
                        tag: object(wrong_num_of_params)
                      ),
                      cond: not(
                        fn_call(
                          name: fn_symbol(arity_is_correct),
                          params: [
                            accessor(expr: const_or_var(expr), field: object(name)),
                            fn_call(
                              name: fn_symbol(length),
                              params: [accessor(expr: const_or_var(expr), field: object(params))],
                              named_params: []
                            )
                          ],
                          named_params: []
                        )
                      )
                    )
                  }
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(builtin_call))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(left)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(right)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(and)))
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(left)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(right)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(or)))
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(expr_wf_errors),
              params: [const_or_var(e), const_or_var(def_vars)],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: var_ptrn(name: var(e)), tag: obj_ptrn(object(not)))
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(left)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(right)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(eq)))
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(left)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(right)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(neq)))
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(obj)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(type_wf_errors),
                  params: [accessor(expr: const_or_var(expr), field: object(type))],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(membership))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(expr_wf_errors),
              params: [
                accessor(expr: const_or_var(expr), field: object(expr)),
                const_or_var(def_vars)
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(accessor)))
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(expr_wf_errors),
              params: [
                accessor(expr: const_or_var(expr), field: object(expr)),
                const_or_var(def_vars)
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(accessor_test))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(clauses_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(source)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(exprs_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(sel_exprs)),
                    fn_call(
                      name: op_symbol(amp),
                      params: [
                        const_or_var(def_vars),
                        fn_call(
                          name: fn_symbol(syn_new_vars),
                          params: [accessor(expr: const_or_var(expr), field: object(source))],
                          named_params: []
                        )
                      ],
                      named_params: []
                    )
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(ex_qual)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(def_vars),
                      fn_call(
                        name: fn_symbol(syn_new_vars),
                        params: [accessor(expr: const_or_var(expr), field: object(source))],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [
                      fn_call(
                        name: op_symbol(amp),
                        params: [
                          fn_call(
                            name: fn_symbol(clauses_wf_errors),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(source)),
                              const_or_var(def_vars)
                            ],
                            named_params: []
                          ),
                          fn_call(
                            name: fn_symbol(exprs_wf_errors),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(sel_exprs)),
                              const_or_var(vs)
                            ],
                            named_params: []
                          )
                        ],
                        named_params: []
                      ),
                      fn_call(
                        name: fn_symbol(expr_wf_errors),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(expr)),
                          const_or_var(vs)
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(set_comp)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(def_vars),
                      fn_call(
                        name: fn_symbol(syn_new_vars),
                        params: [accessor(expr: const_or_var(expr), field: object(source))],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [
                      fn_call(
                        name: op_symbol(amp),
                        params: [
                          fn_call(
                            name: op_symbol(amp),
                            params: [
                              fn_call(
                                name: fn_symbol(clauses_wf_errors),
                                params: [
                                  accessor(expr: const_or_var(expr), field: object(source)),
                                  const_or_var(def_vars)
                                ],
                                named_params: []
                              ),
                              fn_call(
                                name: fn_symbol(exprs_wf_errors),
                                params: [
                                  accessor(expr: const_or_var(expr), field: object(sel_exprs)),
                                  const_or_var(vs)
                                ],
                                named_params: []
                              )
                            ],
                            named_params: []
                          ),
                          fn_call(
                            name: fn_symbol(expr_wf_errors),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(key_expr)),
                              const_or_var(vs)
                            ],
                            named_params: []
                          )
                        ],
                        named_params: []
                      ),
                      fn_call(
                        name: fn_symbol(expr_wf_errors),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(value_expr)),
                          const_or_var(vs)
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(map_comp)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(def_vars),
                      set_expr(
                        {
                          accessor(expr: const_or_var(expr), field: object(var)),
                          cond_expr(
                            expr: accessor(expr: const_or_var(expr), field: object(idx_var)),
                            cond: accessor_test(expr: const_or_var(expr), field: object(idx_var))
                          )
                        }
                      )
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      fn_call(
                        name: fn_symbol(expr_wf_errors),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(src_expr)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      fn_call(
                        name: fn_symbol(expr_wf_errors),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(expr)),
                          const_or_var(vs)
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(errs)
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: accessor_test(expr: const_or_var(expr), field: object(sel_expr)),
                      body: [
                        assignment_stmt(
                          value: fn_call(
                            name: op_symbol(amp),
                            params: [
                              const_or_var(errs),
                              fn_call(
                                name: fn_symbol(expr_wf_errors),
                                params: [
                                  accessor(expr: const_or_var(expr), field: object(sel_expr)),
                                  const_or_var(vs)
                                ],
                                named_params: []
                              )
                            ],
                            named_params: []
                          ),
                          var: var(errs)
                        )
                      ]
                    )
                  ]
                ),
                return_stmt(const_or_var(errs))
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(seq_comp)))
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(else)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(union),
                  params: [
                    set_comp(
                      sel_exprs: [],
                      source: [
                        in_clause(
                          src: fn_call(
                            name: fn_symbol(set),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(branches))
                            ],
                            named_params: []
                          ),
                          ptrn: var_ptrn(name: var(b))
                        ),
                        in_clause(
                          src: set_expr(
                            {
                              accessor(expr: const_or_var(b), field: object(expr)),
                              accessor(expr: const_or_var(b), field: object(cond))
                            }
                          ),
                          ptrn: var_ptrn(name: var(e))
                        )
                      ],
                      expr: fn_call(
                        name: fn_symbol(expr_wf_errors),
                        params: [const_or_var(e), const_or_var(def_vars)],
                        named_params: []
                      )
                    )
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(if_expr)))
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(exprs_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(exprs)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(cases_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(cases)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(match_expr))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(stmts_wf_errors),
              params: [const_or_var(ss), const_or_var(def_vars)],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(ss)),
                tag: obj_ptrn(object(do_expr))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(type_wf_errors),
                  params: [accessor(expr: const_or_var(expr), field: object(type))],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(src_expr)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(select_expr))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(def_vars),
                      fn_call(
                        name: fn_symbol(new_vars),
                        params: [accessor(expr: const_or_var(expr), field: object(ptrn))],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(ptrn_wf_errors),
                    params: [
                      accessor(expr: const_or_var(expr), field: object(ptrn)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(errs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(errs),
                      fn_call(
                        name: fn_symbol(expr_wf_errors),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(src_expr)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(errs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(errs),
                      fn_call(
                        name: fn_symbol(expr_wf_errors),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(expr)),
                          const_or_var(vs)
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(errs)
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: accessor_test(expr: const_or_var(expr), field: object(cond)),
                      body: [
                        assignment_stmt(
                          value: fn_call(
                            name: op_symbol(amp),
                            params: [
                              const_or_var(errs),
                              fn_call(
                                name: fn_symbol(expr_wf_errors),
                                params: [
                                  accessor(expr: const_or_var(expr), field: object(cond)),
                                  const_or_var(vs)
                                ],
                                named_params: []
                              )
                            ],
                            named_params: []
                          ),
                          var: var(errs)
                        )
                      ]
                    )
                  ]
                ),
                return_stmt(const_or_var(errs))
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(retrieve_expr))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: op_symbol(amp),
                  params: [
                    fn_call(
                      name: fn_symbol(ptrn_wf_errors),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(ptrn)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    fn_call(
                      name: fn_symbol(expr_wf_errors),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(src_expr)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(src_expr)),
                    fn_call(
                      name: op_symbol(amp),
                      params: [
                        const_or_var(def_vars),
                        fn_call(
                          name: fn_symbol(new_vars),
                          params: [accessor(expr: const_or_var(expr), field: object(ptrn))],
                          named_params: []
                        )
                      ],
                      named_params: []
                    )
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(replace_expr))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(type_wf_errors),
                  params: [accessor(expr: const_or_var(expr), field: object(type))],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(expr)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(is_expr)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(impl_params),
                      set_comp(
                        sel_exprs: [],
                        source: [
                          in_clause(
                            src: fn_call(
                              name: fn_symbol(set),
                              params: [accessor(expr: const_or_var(expr), field: object(fndefs))],
                              named_params: []
                            ),
                            ptrn: var_ptrn(name: var(fd))
                          )
                        ],
                        expr: fn_call(
                          name: fn_symbol(untyped_sgn),
                          params: [const_or_var(fd)],
                          named_params: []
                        )
                      )
                    ],
                    named_params: []
                  ),
                  var: var(ips)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(expr_wf_errors),
                    params: [
                      accessor(expr: const_or_var(expr), field: object(expr)),
                      const_or_var(def_vars)
                    ],
                    named_params: [
                      syn_fn_def(
                        name: fn_symbol(impl_params),
                        params: [],
                        local_fns: [],
                        expr: const_or_var(ips)
                      )
                    ]
                  ),
                  var: var(expr_errs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(fndefs_wf_errors),
                    params: [
                      fn_call(
                        name: fn_symbol(set),
                        params: [accessor(expr: const_or_var(expr), field: object(fndefs))],
                        named_params: []
                      ),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(fndef_errs)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [const_or_var(expr_errs), const_or_var(fndef_errs)],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(where_expr))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(stmts_wf_errors),
                  params: [
                    fn_call(
                      name: op_symbol(amp),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(stmts)),
                        seq_expr(
                          head: [
                            tag_obj_expr(
                              obj: accessor(expr: const_or_var(expr), field: object(expr)),
                              tag: object(return_stmt)
                            )
                          ]
                        )
                      ],
                      named_params: []
                    ),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(expr), field: object(expr)),
                    fn_call(
                      name: op_symbol(amp),
                      params: [
                        const_or_var(def_vars),
                        fn_call(
                          name: fn_symbol(syn_new_vars),
                          params: [accessor(expr: const_or_var(expr), field: object(stmts))],
                          named_params: []
                        )
                      ],
                      named_params: []
                    )
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(let_expr)))
            ]
          )
        ],
        exprs: [fn_par(0), fn_par(1)]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(fndefs_wf_errors),
      params: [
        (
          type: set_type(
            nonempty: false,
            elem_type: type_ref(type_symbol(synfndef))
          ),
          var: var(fndefs)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(
            value: set_comp(
              sel_exprs: [
                neq(left: const_or_var(fd1), right: const_or_var(fd2)),
                eq(
                  left: fn_call(
                    name: fn_symbol(untyped_sgn),
                    params: [const_or_var(fd1)],
                    named_params: []
                  ),
                  right: fn_call(
                    name: fn_symbol(untyped_sgn),
                    params: [const_or_var(fd2)],
                    named_params: []
                  )
                )
              ],
              source: [
                in_clause(src: const_or_var(fndefs), ptrn: var_ptrn(name: var(fd1))),
                in_clause(src: const_or_var(fndefs), ptrn: var_ptrn(name: var(fd2)))
              ],
              expr: tag_obj_expr(
                obj: fn_call(
                  name: fn_symbol(untyped_sgn),
                  params: [const_or_var(fd1)],
                  named_params: []
                ),
                tag: object(dup_closure_def)
              )
            ),
            var: var(dup_errs)
          ),
          return_stmt(
            fn_call(
              name: op_symbol(amp),
              params: [
                const_or_var(dup_errs),
                fn_call(
                  name: fn_symbol(union),
                  params: [
                    set_comp(
                      sel_exprs: [],
                      source: [
                        in_clause(src: const_or_var(fndefs), ptrn: var_ptrn(name: var(fd)))
                      ],
                      expr: fn_call(
                        name: fn_symbol(fndef_wf_errors),
                        params: [const_or_var(fd), const_or_var(def_vars)],
                        named_params: []
                      )
                    )
                  ],
                  named_params: []
                )
              ],
              named_params: []
            )
          )
        ]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(fndef_wf_errors),
      params: [
        (type: type_ref(type_symbol(synfndef)), var: var(fndef)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(value: const_or_var(def_vars), var: var(vs)),
          assignment_stmt(value: set_expr({}), var: var(sgn_errs)),
          for_stmt(
            body: [
              assert_stmt(
                not(accessor_test(expr: const_or_var(p), field: object(type)))
              ),
              if_stmt(
                else: [],
                branches: [
                  (
                    cond: accessor_test(expr: const_or_var(p), field: object(var)),
                    body: [
                      if_stmt(
                        else: [],
                        branches: [
                          (
                            cond: fn_call(
                              name: fn_symbol(in),
                              params: [
                                accessor(expr: const_or_var(p), field: object(var)),
                                const_or_var(vs)
                              ],
                              named_params: []
                            ),
                            body: [
                              assignment_stmt(
                                value: fn_call(
                                  name: op_symbol(amp),
                                  params: [
                                    const_or_var(sgn_errs),
                                    set_expr(
                                      {
                                        tag_obj_expr(
                                          obj: accessor(expr: const_or_var(p), field: object(var)),
                                          tag: object(var_redef)
                                        )
                                      }
                                    )
                                  ],
                                  named_params: []
                                ),
                                var: var(sgn_errs)
                              )
                            ]
                          )
                        ]
                      ),
                      assignment_stmt(
                        value: fn_call(
                          name: op_symbol(amp),
                          params: [
                            const_or_var(vs),
                            set_expr({accessor(expr: const_or_var(p), field: object(var))})
                          ],
                          named_params: []
                        ),
                        var: var(vs)
                      )
                    ]
                  )
                ]
              )
            ],
            loops: [
              seq_iter(
                var: var(p),
                values: accessor(expr: const_or_var(fndef), field: object(params))
              )
            ]
          ),
          return_stmt(
            fn_call(
              name: op_symbol(amp),
              params: [
                const_or_var(sgn_errs),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(fndef), field: object(expr)),
                    const_or_var(vs)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            )
          )
        ]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(exprs_wf_errors),
      params: [
        (
          type: seq_type(
            nonempty: false,
            elem_type: type_ref(type_symbol(synsubexpr))
          ),
          var: var(exprs)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(vs)
        )
      ],
      local_fns: [],
      expr: fn_call(
        name: fn_symbol(seq_union),
        params: [
          seq_comp(
            var: var(e),
            expr: fn_call(
              name: fn_symbol(expr_wf_errors),
              params: [const_or_var(e), const_or_var(vs)],
              named_params: []
            ),
            src_expr: const_or_var(exprs)
          )
        ],
        named_params: []
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(expr_wf_errors),
      params: [
        (type: type_ref(type_symbol(syncondexpr)), var: var(se)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(vs)
        )
      ],
      local_fns: [],
      expr: fn_call(
        name: op_symbol(amp),
        params: [
          fn_call(
            name: fn_symbol(expr_wf_errors),
            params: [
              accessor(expr: const_or_var(se), field: object(expr)),
              const_or_var(vs)
            ],
            named_params: []
          ),
          fn_call(
            name: fn_symbol(expr_wf_errors),
            params: [
              accessor(expr: const_or_var(se), field: object(cond)),
              const_or_var(vs)
            ],
            named_params: []
          )
        ],
        named_params: []
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(stmts_wf_errors),
      params: [
        (
          type: seq_type(nonempty: true, elem_type: type_ref(type_symbol(synstmt))),
          var: var(stmts)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(stmts_wf_errors),
              params: [
                const_or_var(stmts),
                const_or_var(def_vars),
                const_or_var(def_vars),
                object(false)
              ],
              named_params: []
            ),
            var: var(errs)
          ),
          if_stmt(
            else: [],
            branches: [
              (
                cond: not(
                  fn_call(
                    name: fn_symbol(never_falls_through),
                    params: [const_or_var(stmts)],
                    named_params: []
                  )
                ),
                body: [
                  assignment_stmt(
                    value: fn_call(
                      name: op_symbol(amp),
                      params: [const_or_var(errs), set_expr({object(no_ret_stmt)})],
                      named_params: []
                    ),
                    var: var(errs)
                  )
                ]
              )
            ]
          ),
          return_stmt(const_or_var(errs))
        ]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(stmts_wf_errors),
      params: [
        (
          type: seq_type(nonempty: false, elem_type: type_ref(type_symbol(synstmt))),
          var: var(stmts)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(all_def_vars)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(readonly_vars)
        ),
        (type: type_ref(type_symbol(bool)), var: var(inside_loop))
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(value: const_or_var(all_def_vars), var: var(vs)),
          assignment_stmt(value: object(true), var: var(reachable)),
          assignment_stmt(value: set_expr({}), var: var(errs)),
          for_stmt(
            body: [
              if_stmt(
                else: [],
                branches: [
                  (
                    cond: not(const_or_var(reachable)),
                    body: [
                      assignment_stmt(
                        value: fn_call(
                          name: op_symbol(amp),
                          params: [const_or_var(errs), set_expr({object(unreachable_code)})],
                          named_params: []
                        ),
                        var: var(errs)
                      )
                    ]
                  )
                ]
              ),
              assignment_stmt(
                value: fn_call(
                  name: op_symbol(amp),
                  params: [
                    const_or_var(errs),
                    fn_call(
                      name: fn_symbol(stmt_wf_errors),
                      params: [
                        const_or_var(s),
                        const_or_var(vs),
                        const_or_var(readonly_vars),
                        const_or_var(inside_loop)
                      ],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                var: var(errs)
              ),
              assignment_stmt(
                value: fn_call(
                  name: op_symbol(amp),
                  params: [
                    const_or_var(vs),
                    fn_call(
                      name: fn_symbol(syn_new_vars),
                      params: [const_or_var(s)],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                var: var(vs)
              ),
              assignment_stmt(
                value: and(
                  left: const_or_var(reachable),
                  right: not(
                    fn_call(
                      name: fn_symbol(syn_is_last_for_sure),
                      params: [const_or_var(s)],
                      named_params: []
                    )
                  )
                ),
                var: var(reachable)
              )
            ],
            loops: [seq_iter(var: var(s), values: const_or_var(stmts))]
          ),
          return_stmt(const_or_var(errs))
        ]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(stmt_wf_errors),
      params: [
        (type: type_ref(type_symbol(synstmt)), var: var(stmt)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(all_def_vars)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(readonly_vars)
        ),
        (type: type_ref(type_symbol(bool)), var: var(inside_loop))
      ],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(stmt), field: object(value)),
                    const_or_var(all_def_vars)
                  ],
                  named_params: []
                ),
                set_expr(
                  {
                    cond_expr(
                      expr: tag_obj_expr(
                        obj: accessor(expr: const_or_var(stmt), field: object(var)),
                        tag: object(asgnm_readonly_var)
                      ),
                      cond: fn_call(
                        name: fn_symbol(in),
                        params: [
                          accessor(expr: const_or_var(stmt), field: object(var)),
                          const_or_var(readonly_vars)
                        ],
                        named_params: []
                      )
                    )
                  }
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(assignment_stmt))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(expr_wf_errors),
              params: [const_or_var(e), const_or_var(all_def_vars)],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(e)),
                tag: obj_ptrn(object(return_stmt))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(expr_wf_errors),
              params: [const_or_var(e), const_or_var(all_def_vars)],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(e)),
                tag: obj_ptrn(object(assert_stmt))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(expr_wf_errors),
              params: [const_or_var(e), const_or_var(all_def_vars)],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(e)),
                tag: obj_ptrn(object(print_stmt))
              )
            ]
          ),
          case(
            expr: set_expr({}),
            patterns: [obj_ptrn(object(fail_stmt))]
          ),
          case(
            expr: set_expr(
              {
                cond_expr(
                  expr: object(break_outside_loop),
                  cond: not(const_or_var(inside_loop))
                )
              }
            ),
            patterns: [obj_ptrn(object(break_stmt))]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(stmts_wf_errors),
                  params: [
                    const_or_var(ss),
                    const_or_var(all_def_vars),
                    const_or_var(readonly_vars),
                    object(true)
                  ],
                  named_params: []
                ),
                set_expr(
                  {
                    cond_expr(
                      expr: object(no_way_out_loop),
                      cond: and(
                        left: not(
                          fn_call(
                            name: fn_symbol(has_top_level_break),
                            params: [const_or_var(ss)],
                            named_params: []
                          )
                        ),
                        right: not(
                          fn_call(
                            name: fn_symbol(has_return),
                            params: [const_or_var(ss)],
                            named_params: []
                          )
                        )
                      )
                    )
                  }
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(ss)),
                tag: obj_ptrn(object(inf_loop_stmt))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: seq_comp(
                    var: var(b),
                    expr: fn_call(
                      name: fn_symbol(expr_wf_errors),
                      params: [
                        accessor(expr: const_or_var(b), field: object(cond)),
                        const_or_var(all_def_vars)
                      ],
                      named_params: []
                    ),
                    src_expr: accessor(expr: const_or_var(stmt), field: object(branches))
                  ),
                  var: var(errs_cond)
                ),
                assignment_stmt(
                  value: seq_comp(
                    var: var(b),
                    expr: fn_call(
                      name: fn_symbol(stmts_wf_errors),
                      params: [
                        accessor(expr: const_or_var(b), field: object(body)),
                        const_or_var(all_def_vars),
                        const_or_var(readonly_vars),
                        const_or_var(inside_loop)
                      ],
                      named_params: []
                    ),
                    src_expr: accessor(expr: const_or_var(stmt), field: object(branches))
                  ),
                  var: var(errs_body)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(stmts_wf_errors),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(else)),
                      const_or_var(all_def_vars),
                      const_or_var(readonly_vars),
                      const_or_var(inside_loop)
                    ],
                    named_params: []
                  ),
                  var: var(errs_else)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [
                      fn_call(
                        name: op_symbol(amp),
                        params: [
                          fn_call(
                            name: fn_symbol(seq_union),
                            params: [const_or_var(errs_cond)],
                            named_params: []
                          ),
                          fn_call(
                            name: fn_symbol(seq_union),
                            params: [const_or_var(errs_body)],
                            named_params: []
                          )
                        ],
                        named_params: []
                      ),
                      const_or_var(errs_else)
                    ],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(if_stmt)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(value: const_or_var(all_def_vars), var: var(vs)),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: accessor(expr: const_or_var(stmt), field: object(skip_first)),
                      body: [
                        assignment_stmt(
                          value: fn_call(
                            name: op_symbol(amp),
                            params: [
                              const_or_var(vs),
                              fn_call(
                                name: fn_symbol(syn_new_vars),
                                params: [accessor(expr: const_or_var(stmt), field: object(body))],
                                named_params: []
                              )
                            ],
                            named_params: []
                          ),
                          var: var(vs)
                        )
                      ]
                    )
                  ]
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(expr_wf_errors),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(cond)),
                      const_or_var(vs)
                    ],
                    named_params: []
                  ),
                  var: var(errs_cond)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(stmts_wf_errors),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(body)),
                      const_or_var(all_def_vars),
                      const_or_var(readonly_vars),
                      object(true)
                    ],
                    named_params: []
                  ),
                  var: var(errs_body)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [const_or_var(errs_cond), const_or_var(errs_body)],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(loop_stmt)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(value: const_or_var(all_def_vars), var: var(vs)),
                assignment_stmt(value: set_expr({}), var: var(errs)),
                for_stmt(
                  body: [
                    assignment_stmt(
                      value: fn_call(
                        name: op_symbol(amp),
                        params: [
                          const_or_var(errs),
                          fn_call(
                            name: fn_symbol(iter_wf_errors),
                            params: [const_or_var(it), const_or_var(vs)],
                            named_params: []
                          )
                        ],
                        named_params: []
                      ),
                      var: var(errs)
                    ),
                    assignment_stmt(
                      value: fn_call(
                        name: op_symbol(amp),
                        params: [
                          const_or_var(vs),
                          fn_call(
                            name: fn_symbol(syn_new_vars),
                            params: [const_or_var(it)],
                            named_params: []
                          )
                        ],
                        named_params: []
                      ),
                      var: var(vs)
                    )
                  ],
                  loops: [
                    seq_iter(
                      var: var(it),
                      values: accessor(expr: const_or_var(stmt), field: object(loops))
                    )
                  ]
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(errs),
                      fn_call(
                        name: fn_symbol(stmts_wf_errors),
                        params: [
                          accessor(expr: const_or_var(stmt), field: object(body)),
                          const_or_var(vs),
                          const_or_var(readonly_vars),
                          object(true)
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(for_stmt)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(fndefs_wf_errors),
                    params: [
                      fn_call(
                        name: fn_symbol(set),
                        params: [accessor(expr: const_or_var(stmt), field: object(asgnms))],
                        named_params: []
                      ),
                      const_or_var(all_def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(asgnms_errs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(impl_params),
                      fn_call(
                        name: fn_symbol(set),
                        params: [
                          seq_comp(
                            var: var(fd),
                            expr: fn_call(
                              name: fn_symbol(untyped_sgn),
                              params: [const_or_var(fd)],
                              named_params: []
                            ),
                            src_expr: accessor(expr: const_or_var(stmt), field: object(asgnms))
                          )
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(new_impl_params)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(stmts_wf_errors),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(body)),
                      const_or_var(all_def_vars),
                      const_or_var(readonly_vars),
                      const_or_var(inside_loop)
                    ],
                    named_params: [
                      syn_fn_def(
                        name: fn_symbol(impl_params),
                        params: [],
                        local_fns: [],
                        expr: const_or_var(new_impl_params)
                      )
                    ]
                  ),
                  var: var(stmts_errs)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [const_or_var(asgnms_errs), const_or_var(stmts_errs)],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(let_stmt)))
            ]
          )
        ],
        exprs: [fn_par(0), fn_par(1), fn_par(2), fn_par(3)]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(iter_wf_errors),
      params: [
        (type: type_ref(type_symbol(syniter)), var: var(iter)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(iter), field: object(values)),
                    const_or_var(def_vars)
                  ],
                  named_params: []
                ),
                set_expr(
                  {
                    cond_expr(
                      expr: tag_obj_expr(
                        obj: accessor(expr: const_or_var(iter), field: object(var)),
                        tag: object(var_redef)
                      ),
                      cond: fn_call(
                        name: fn_symbol(in),
                        params: [
                          accessor(expr: const_or_var(iter), field: object(var)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      )
                    ),
                    cond_expr(
                      expr: tag_obj_expr(
                        obj: accessor(expr: const_or_var(iter), field: object(idx_var)),
                        tag: object(var_redef)
                      ),
                      cond: and(
                        left: accessor_test(expr: const_or_var(iter), field: object(idx_var)),
                        right: fn_call(
                          name: fn_symbol(in),
                          params: [
                            accessor(expr: const_or_var(iter), field: object(idx_var)),
                            const_or_var(def_vars)
                          ],
                          named_params: []
                        )
                      )
                    )
                  }
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(seq_iter)))
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: op_symbol(amp),
                  params: [
                    fn_call(
                      name: fn_symbol(expr_wf_errors),
                      params: [
                        accessor(expr: const_or_var(iter), field: object(start_val)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    fn_call(
                      name: fn_symbol(expr_wf_errors),
                      params: [
                        accessor(expr: const_or_var(iter), field: object(end_val)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                set_expr(
                  {
                    cond_expr(
                      expr: tag_obj_expr(
                        obj: accessor(expr: const_or_var(iter), field: object(var)),
                        tag: object(var_redef)
                      ),
                      cond: fn_call(
                        name: fn_symbol(in),
                        params: [
                          accessor(expr: const_or_var(iter), field: object(var)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      )
                    )
                  }
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(range_iter))
              )
            ]
          )
        ],
        exprs: [fn_par(0), fn_par(1)]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(case_wf_errors),
      params: [
        (type: type_ref(type_symbol(syncase)), var: var(syn_case)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(value: const_or_var(def_vars), var: var(vs)),
          assignment_stmt(value: set_expr({}), var: var(errs)),
          for_stmt(
            body: [
              assignment_stmt(
                value: fn_call(
                  name: fn_symbol(new_vars),
                  params: [const_or_var(p)],
                  named_params: []
                ),
                var: var(pvs)
              ),
              assignment_stmt(
                value: fn_call(
                  name: op_symbol(amp),
                  params: [
                    const_or_var(errs),
                    set_comp(
                      sel_exprs: [],
                      source: [
                        in_clause(
                          src: fn_call(
                            name: fn_symbol(intersection),
                            params: [const_or_var(pvs), const_or_var(vs)],
                            named_params: []
                          ),
                          ptrn: var_ptrn(name: var(v))
                        )
                      ],
                      expr: tag_obj_expr(obj: const_or_var(v), tag: object(already_def_ptrn_var))
                    )
                  ],
                  named_params: []
                ),
                var: var(errs)
              ),
              if_stmt(
                else: [],
                branches: [
                  (
                    cond: membership(
                      type: union_type(
                        {
                          tag_type(
                            obj_type: tuple_type(
                              {
                                (
                                  type: type_ref(type_symbol(var)),
                                  optional: false,
                                  label: object(name)
                                )
                              }
                            ),
                            tag_type: symb_type(object(ptrn_var))
                          )
                        }
                      ),
                      obj: const_or_var(p)
                    ),
                    body: [
                      assignment_stmt(
                        value: fn_call(
                          name: op_symbol(amp),
                          params: [
                            const_or_var(errs),
                            set_expr(
                              {
                                tag_obj_expr(
                                  obj: accessor(expr: const_or_var(p), field: object(name)),
                                  tag: object(free_var_in_try_expr)
                                )
                              }
                            )
                          ],
                          named_params: []
                        ),
                        var: var(errs)
                      )
                    ]
                  )
                ]
              ),
              assignment_stmt(
                value: fn_call(
                  name: op_symbol(amp),
                  params: [
                    const_or_var(errs),
                    fn_call(
                      name: fn_symbol(ptrn_wf_errors),
                      params: [const_or_var(p), set_expr({})],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                var: var(errs)
              ),
              assignment_stmt(
                value: fn_call(
                  name: op_symbol(amp),
                  params: [const_or_var(vs), const_or_var(pvs)],
                  named_params: []
                ),
                var: var(vs)
              )
            ],
            loops: [
              seq_iter(
                var: var(p),
                values: accessor(expr: const_or_var(syn_case), field: object(patterns))
              )
            ]
          ),
          return_stmt(
            fn_call(
              name: op_symbol(amp),
              params: [
                const_or_var(errs),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(syn_case), field: object(expr)),
                    const_or_var(vs)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            )
          )
        ]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(cases_wf_errors),
      params: [
        (
          type: seq_type(nonempty: true, elem_type: type_ref(type_symbol(syncase))),
          var: var(cs)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(vs)
        )
      ],
      local_fns: [],
      expr: fn_call(
        name: fn_symbol(seq_union),
        params: [
          seq_comp(
            var: var(c),
            expr: fn_call(
              name: fn_symbol(case_wf_errors),
              params: [const_or_var(c), const_or_var(vs)],
              named_params: []
            ),
            src_expr: const_or_var(cs)
          )
        ],
        named_params: []
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(clause_wf_errors),
      params: [
        (type: type_ref(type_symbol(synclause)), var: var(clause)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(ext_vars)
        )
      ],
      local_fns: [],
      expr: fn_call(
        name: fn_symbol(clause_wf_errors),
        params: [const_or_var(clause), set_expr({}), const_or_var(ext_vars)],
        named_params: []
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(clause_wf_errors),
      params: [
        (type: type_ref(type_symbol(synclause)), var: var(clause)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(loc_vars)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(ext_vars)
        )
      ],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(ptrn_wf_errors),
                  params: [
                    accessor(expr: const_or_var(clause), field: object(ptrn)),
                    const_or_var(ext_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(clause), field: object(src)),
                    fn_call(
                      name: op_symbol(amp),
                      params: [const_or_var(loc_vars), const_or_var(ext_vars)],
                      named_params: []
                    )
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(in_clause)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(ptrn_wf_errors),
                    params: [
                      accessor(expr: const_or_var(clause), field: object(ptrn)),
                      const_or_var(ext_vars)
                    ],
                    named_params: []
                  ),
                  var: var(ptrn_errs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(minus),
                    params: [
                      fn_call(
                        name: fn_symbol(new_vars),
                        params: [accessor(expr: const_or_var(clause), field: object(ptrn))],
                        named_params: []
                      ),
                      const_or_var(loc_vars)
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: neq(left: const_or_var(vs), right: set_expr({})),
                      body: [
                        assignment_stmt(
                          value: fn_call(
                            name: op_symbol(amp),
                            params: [
                              const_or_var(ptrn_errs),
                              set_expr(
                                {
                                  tag_obj_expr(
                                    obj: const_or_var(vs),
                                    tag: object(unbound_vars_in_excl_clause)
                                  )
                                }
                              )
                            ],
                            named_params: []
                          ),
                          var: var(ptrn_errs)
                        )
                      ]
                    )
                  ]
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(expr_wf_errors),
                    params: [
                      accessor(expr: const_or_var(clause), field: object(src)),
                      const_or_var(ext_vars)
                    ],
                    named_params: []
                  ),
                  var: var(expr_errs)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [const_or_var(ptrn_errs), const_or_var(expr_errs)],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(not_in_clause))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: op_symbol(amp),
                  params: [
                    fn_call(
                      name: fn_symbol(ptrn_wf_errors),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(key_ptrn)),
                        const_or_var(ext_vars)
                      ],
                      named_params: []
                    ),
                    fn_call(
                      name: fn_symbol(ptrn_wf_errors),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(value_ptrn)),
                        const_or_var(ext_vars)
                      ],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(clause), field: object(src)),
                    fn_call(
                      name: op_symbol(amp),
                      params: [const_or_var(loc_vars), const_or_var(ext_vars)],
                      named_params: []
                    )
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(map_in_clause))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      fn_call(
                        name: fn_symbol(ptrn_wf_errors),
                        params: [
                          accessor(expr: const_or_var(clause), field: object(key_ptrn)),
                          const_or_var(ext_vars)
                        ],
                        named_params: []
                      ),
                      fn_call(
                        name: fn_symbol(ptrn_wf_errors),
                        params: [
                          accessor(expr: const_or_var(clause), field: object(value_ptrn)),
                          const_or_var(ext_vars)
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(ptrn_errs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(minus),
                    params: [
                      fn_call(
                        name: op_symbol(amp),
                        params: [
                          fn_call(
                            name: fn_symbol(new_vars),
                            params: [
                              accessor(expr: const_or_var(clause), field: object(key_ptrn))
                            ],
                            named_params: []
                          ),
                          fn_call(
                            name: fn_symbol(new_vars),
                            params: [
                              accessor(expr: const_or_var(clause), field: object(value_ptrn))
                            ],
                            named_params: []
                          )
                        ],
                        named_params: []
                      ),
                      const_or_var(loc_vars)
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: neq(left: const_or_var(vs), right: set_expr({})),
                      body: [
                        assignment_stmt(
                          value: fn_call(
                            name: op_symbol(amp),
                            params: [
                              const_or_var(ptrn_errs),
                              set_expr(
                                {
                                  tag_obj_expr(
                                    obj: const_or_var(vs),
                                    tag: object(unbound_vars_in_excl_clause)
                                  )
                                }
                              )
                            ],
                            named_params: []
                          ),
                          var: var(ptrn_errs)
                        )
                      ]
                    )
                  ]
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(expr_wf_errors),
                    params: [
                      accessor(expr: const_or_var(clause), field: object(src)),
                      const_or_var(ext_vars)
                    ],
                    named_params: []
                  ),
                  var: var(expr_errs)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [const_or_var(ptrn_errs), const_or_var(expr_errs)],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(map_not_in_clause))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(expr_wf_errors),
                  params: [
                    accessor(expr: const_or_var(clause), field: object(expr)),
                    fn_call(
                      name: op_symbol(amp),
                      params: [const_or_var(loc_vars), const_or_var(ext_vars)],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                set_expr(
                  {
                    cond_expr(
                      expr: tag_obj_expr(
                        obj: accessor(expr: const_or_var(clause), field: object(var)),
                        tag: object(already_def_ptrn_var)
                      ),
                      cond: fn_call(
                        name: fn_symbol(in),
                        params: [
                          accessor(expr: const_or_var(clause), field: object(var)),
                          fn_call(
                            name: op_symbol(amp),
                            params: [const_or_var(loc_vars), const_or_var(ext_vars)],
                            named_params: []
                          )
                        ],
                        named_params: []
                      )
                    )
                  }
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(eq_clause)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(value: const_or_var(loc_vars), var: var(vs)),
                assignment_stmt(value: set_expr({}), var: var(errs)),
                for_stmt(
                  body: [
                    assignment_stmt(
                      value: fn_call(
                        name: op_symbol(amp),
                        params: [
                          const_or_var(errs),
                          fn_call(
                            name: fn_symbol(clause_wf_errors),
                            params: [const_or_var(c), const_or_var(vs), const_or_var(ext_vars)],
                            named_params: []
                          )
                        ],
                        named_params: []
                      ),
                      var: var(errs)
                    ),
                    assignment_stmt(
                      value: fn_call(
                        name: op_symbol(amp),
                        params: [
                          const_or_var(vs),
                          fn_call(
                            name: fn_symbol(syn_new_vars),
                            params: [const_or_var(c)],
                            named_params: []
                          )
                        ],
                        named_params: []
                      ),
                      var: var(vs)
                    )
                  ],
                  loops: [seq_iter(var: var(c), values: const_or_var(cs))]
                ),
                return_stmt(const_or_var(errs))
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(cs)),
                tag: obj_ptrn(object(and_clause))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(clause_wf_errors),
                  params: [
                    accessor(expr: const_or_var(clause), field: object(left)),
                    const_or_var(loc_vars),
                    const_or_var(ext_vars)
                  ],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(clause_wf_errors),
                  params: [
                    accessor(expr: const_or_var(clause), field: object(right)),
                    const_or_var(loc_vars),
                    const_or_var(ext_vars)
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(or_clause)))
            ]
          )
        ],
        exprs: [fn_par(0), fn_par(1), fn_par(2)]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(clauses_wf_errors),
      params: [
        (
          type: seq_type(
            nonempty: true,
            elem_type: type_ref(type_symbol(synclause))
          ),
          var: var(clauses)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: fn_call(
        name: fn_symbol(clause_wf_errors),
        params: [
          tag_obj_expr(obj: const_or_var(clauses), tag: object(and_clause)),
          const_or_var(def_vars)
        ],
        named_params: []
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(ptrn_wf_errors),
      params: [
        (type: type_ref(type_symbol(pattern)), var: var(ptrn)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(ext_vars)
        )
      ],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: set_expr({}),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(obj_ptrn)))
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(type_wf_errors),
              params: [const_or_var(type)],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(type)),
                tag: obj_ptrn(object(type_ptrn))
              )
            ]
          ),
          case(
            expr: set_expr(
              {
                cond_expr(
                  expr: tag_obj_expr(obj: const_or_var(v), tag: object(undef_bound_ptrn_var)),
                  cond: not(
                    fn_call(
                      name: fn_symbol(in),
                      params: [const_or_var(v), const_or_var(ext_vars)],
                      named_params: []
                    )
                  )
                )
              }
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(v)),
                tag: obj_ptrn(object(ext_var_ptrn))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: if_expr(
                    else: set_expr({}),
                    branches: [
                      (
                        expr: fn_call(
                          name: fn_symbol(new_vars),
                          params: [accessor(expr: const_or_var(ptrn), field: object(ptrn))],
                          named_params: []
                        ),
                        cond: accessor_test(expr: const_or_var(ptrn), field: object(ptrn))
                      )
                    ]
                  ),
                  var: var(vs)
                ),
                assignment_stmt(
                  value: if_expr(
                    else: set_expr({}),
                    branches: [
                      (
                        expr: tag_obj_expr(
                          obj: set_expr({accessor(expr: const_or_var(ptrn), field: object(name))}),
                          tag: object(dupl_ptrn_vars)
                        ),
                        cond: fn_call(
                          name: fn_symbol(in),
                          params: [
                            accessor(expr: const_or_var(ptrn), field: object(name)),
                            const_or_var(vs)
                          ],
                          named_params: []
                        )
                      )
                    ]
                  ),
                  var: var(var_errs)
                ),
                assignment_stmt(
                  value: if_expr(
                    else: set_expr({}),
                    branches: [
                      (
                        expr: fn_call(
                          name: fn_symbol(ptrn_wf_errors),
                          params: [
                            accessor(expr: const_or_var(ptrn), field: object(ptrn)),
                            const_or_var(ext_vars)
                          ],
                          named_params: []
                        ),
                        cond: accessor_test(expr: const_or_var(ptrn), field: object(ptrn))
                      )
                    ]
                  ),
                  var: var(ptrn_errs)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [const_or_var(var_errs), const_or_var(ptrn_errs)],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(var_ptrn)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(rand_sort),
                    params: [accessor(expr: const_or_var(ptrn), field: object(fields))],
                    named_params: []
                  ),
                  var: var(bs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(length),
                    params: [const_or_var(bs)],
                    named_params: []
                  ),
                  var: var(len)
                ),
                assignment_stmt(
                  value: seq_comp(
                    var: var(b),
                    expr: accessor(expr: const_or_var(b), field: object(label)),
                    src_expr: const_or_var(bs)
                  ),
                  var: var(ls)
                ),
                assignment_stmt(
                  value: seq_comp(
                    var: var(b),
                    expr: fn_call(
                      name: fn_symbol(new_vars),
                      params: [accessor(expr: const_or_var(b), field: object(ptrn))],
                      named_params: []
                    ),
                    src_expr: const_or_var(bs)
                  ),
                  var: var(bvs)
                ),
                assignment_stmt(value: set_expr({}), var: var(dupl_labs)),
                assignment_stmt(value: set_expr({}), var: var(dupl_vars)),
                for_stmt(
                  body: [
                    if_stmt(
                      else: [],
                      branches: [
                        (
                          cond: eq(
                            left: fn_call(
                              name: op_symbol(brackets),
                              params: [const_or_var(ls), const_or_var(i1)],
                              named_params: []
                            ),
                            right: fn_call(
                              name: op_symbol(brackets),
                              params: [const_or_var(ls), const_or_var(i2)],
                              named_params: []
                            )
                          ),
                          body: [
                            assignment_stmt(
                              value: fn_call(
                                name: op_symbol(amp),
                                params: [
                                  const_or_var(dupl_labs),
                                  set_expr(
                                    {
                                      fn_call(
                                        name: op_symbol(brackets),
                                        params: [const_or_var(ls), const_or_var(i1)],
                                        named_params: []
                                      )
                                    }
                                  )
                                ],
                                named_params: []
                              ),
                              var: var(dupl_labs)
                            )
                          ]
                        )
                      ]
                    ),
                    assignment_stmt(
                      value: fn_call(
                        name: fn_symbol(intersection),
                        params: [
                          fn_call(
                            name: op_symbol(brackets),
                            params: [const_or_var(bvs), const_or_var(i1)],
                            named_params: []
                          ),
                          fn_call(
                            name: op_symbol(brackets),
                            params: [const_or_var(bvs), const_or_var(i2)],
                            named_params: []
                          )
                        ],
                        named_params: []
                      ),
                      var: var(vs)
                    ),
                    if_stmt(
                      else: [],
                      branches: [
                        (
                          cond: neq(left: const_or_var(vs), right: set_expr({})),
                          body: [
                            assignment_stmt(
                              value: fn_call(
                                name: op_symbol(amp),
                                params: [const_or_var(dupl_vars), const_or_var(vs)],
                                named_params: []
                              ),
                              var: var(dupl_vars)
                            )
                          ]
                        )
                      ]
                    )
                  ],
                  loops: [
                    range_iter(
                      var: var(i1),
                      end_val: fn_call(
                        name: op_symbol(minus),
                        params: [const_or_var(len), object(2)],
                        named_params: []
                      ),
                      start_val: object(0)
                    ),
                    range_iter(
                      var: var(i2),
                      end_val: fn_call(
                        name: op_symbol(minus),
                        params: [const_or_var(len), object(1)],
                        named_params: []
                      ),
                      start_val: fn_call(
                        name: op_symbol(plus),
                        params: [const_or_var(i1), object(1)],
                        named_params: []
                      )
                    )
                  ]
                ),
                assignment_stmt(
                  value: if_expr(
                    else: tag_obj_expr(
                      obj: const_or_var(dupl_labs),
                      tag: object(dupl_ptrn_labels)
                    ),
                    branches: [
                      (
                        expr: set_expr({}),
                        cond: eq(left: const_or_var(dupl_labs), right: set_expr({}))
                      )
                    ]
                  ),
                  var: var(dupl_lab_errs)
                ),
                assignment_stmt(
                  value: if_expr(
                    else: tag_obj_expr(obj: const_or_var(dupl_vars), tag: object(dupl_ptrn_vars)),
                    branches: [
                      (
                        expr: set_expr({}),
                        cond: eq(left: const_or_var(dupl_vars), right: set_expr({}))
                      )
                    ]
                  ),
                  var: var(dupl_var_errs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(union),
                    params: [
                      set_comp(
                        sel_exprs: [],
                        source: [
                          in_clause(
                            src: accessor(expr: const_or_var(ptrn), field: object(fields)),
                            ptrn: var_ptrn(name: var(f))
                          )
                        ],
                        expr: fn_call(
                          name: fn_symbol(ptrn_wf_errors),
                          params: [
                            accessor(expr: const_or_var(f), field: object(ptrn)),
                            const_or_var(ext_vars)
                          ],
                          named_params: []
                        )
                      )
                    ],
                    named_params: []
                  ),
                  var: var(sub_ptrn_errs)
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(amp),
                    params: [
                      fn_call(
                        name: op_symbol(amp),
                        params: [const_or_var(dupl_lab_errs), const_or_var(dupl_var_errs)],
                        named_params: []
                      ),
                      const_or_var(sub_ptrn_errs)
                    ],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(tuple_ptrn))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(ptrn_wf_errors),
                    params: [
                      accessor(expr: const_or_var(ptrn), field: object(obj)),
                      const_or_var(ext_vars)
                    ],
                    named_params: []
                  ),
                  var: var(errs)
                ),
                assignment_stmt(
                  value: accessor(expr: const_or_var(ptrn), field: object(tag)),
                  var: var(tag_ptrn)
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: membership(
                        type: union_type(
                          {
                            tag_type(
                              obj_type: tuple_type(
                                {
                                  (
                                    type: type_ref(type_symbol(var)),
                                    optional: false,
                                    label: object(name)
                                  )
                                }
                              ),
                              tag_type: symb_type(object(var_ptrn))
                            )
                          }
                        ),
                        obj: const_or_var(tag_ptrn)
                      ),
                      body: [
                        assignment_stmt(
                          value: accessor(expr: const_or_var(tag_ptrn), field: object(name)),
                          var: var(var)
                        ),
                        assignment_stmt(
                          value: fn_call(
                            name: fn_symbol(new_vars),
                            params: [accessor(expr: const_or_var(ptrn), field: object(obj))],
                            named_params: []
                          ),
                          var: var(obj_vs)
                        ),
                        if_stmt(
                          else: [],
                          branches: [
                            (
                              cond: fn_call(
                                name: fn_symbol(in),
                                params: [const_or_var(var), const_or_var(obj_vs)],
                                named_params: []
                              ),
                              body: [
                                assignment_stmt(
                                  value: fn_call(
                                    name: op_symbol(amp),
                                    params: [
                                      const_or_var(errs),
                                      set_expr(
                                        {
                                          tag_obj_expr(
                                            obj: set_expr({const_or_var(var)}),
                                            tag: object(dupl_ptrn_vars)
                                          )
                                        }
                                      )
                                    ],
                                    named_params: []
                                  ),
                                  var: var(errs)
                                )
                              ]
                            )
                          ]
                        )
                      ]
                    )
                  ]
                ),
                return_stmt(const_or_var(errs))
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(tag_ptrn)))
            ]
          )
        ],
        exprs: [fn_par(0), fn_par(1)]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    )
  ],
  signatures: [
    syn_sgn(
      name: fn_symbol(typedefs),
      params: [],
      res_type: map_type(
        value_type: type_ref(type_symbol(syntype)),
        key_type: type_ref(type_symbol(typesymbol))
      )
    ),
    syn_sgn(
      name: fn_symbol(all_par_type_symbols),
      params: [],
      res_type: set_type(
        nonempty: false,
        elem_type: fixed_seq_type(
          [
            type_ref(type_symbol(basictypesymbol)),
            type_ref(type_symbol(nznat))
          ]
        )
      )
    ),
    syn_sgn(
      name: fn_symbol(type_vars_in_scope),
      params: [],
      res_type: set_type(nonempty: false, elem_type: type_ref(type_symbol(typevar)))
    ),
    syn_sgn(
      name: fn_symbol(fns_in_scope),
      params: [],
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(untypedsgn))
      )
    ),
    syn_sgn(
      name: fn_symbol(impl_params),
      params: [],
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(basicuntypedsgn))
      )
    )
  ]
)
