syn_fn_def(
  name: fn_symbol(new_vars),
  params: [(type: type_ref(type_symbol(pattern)), var: var(ptrn))],
  local_fns: [],
  expr: match_expr(
    cases: [
      case(
        expr: set_expr({}),
        patterns: [
          tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(obj_ptrn)))
        ]
      ),
      case(
        expr: set_expr({}),
        patterns: [
          tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(type_ptrn)))
        ]
      ),
      case(
        expr: set_expr({}),
        patterns: [
          tag_ptrn(
            obj: type_ptrn(type_any),
            tag: obj_ptrn(object(ext_var_ptrn))
          )
        ]
      ),
      case(
        expr: fn_call(
          name: op_symbol(amp),
          params: [
            set_expr({accessor(expr: const_or_var(ptrn), field: object(name))}),
            if_expr(
              else: set_expr({}),
              branches: [
                (
                  expr: fn_call(
                    name: fn_symbol(new_vars),
                    params: [accessor(expr: const_or_var(ptrn), field: object(ptrn))],
                    named_params: []
                  ),
                  cond: accessor_test(expr: const_or_var(ptrn), field: object(ptrn))
                )
              ]
            )
          ],
          named_params: []
        ),
        patterns: [
          tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(var_ptrn)))
        ]
      ),
      case(
        expr: fn_call(
          name: fn_symbol(union),
          params: [
            set_comp(
              sel_exprs: [],
              source: [
                in_clause(
                  src: accessor(expr: const_or_var(ptrn), field: object(fields)),
                  ptrn: var_ptrn(name: var(f))
                )
              ],
              expr: fn_call(
                name: fn_symbol(new_vars),
                params: [accessor(expr: const_or_var(f), field: object(ptrn))],
                named_params: []
              )
            )
          ],
          named_params: []
        ),
        patterns: [
          tag_ptrn(
            obj: type_ptrn(type_any),
            tag: obj_ptrn(object(tuple_ptrn))
          )
        ]
      ),
      case(
        expr: fn_call(
          name: op_symbol(amp),
          params: [
            fn_call(
              name: fn_symbol(new_vars),
              params: [accessor(expr: const_or_var(ptrn), field: object(tag))],
              named_params: []
            ),
            fn_call(
              name: fn_symbol(new_vars),
              params: [accessor(expr: const_or_var(ptrn), field: object(obj))],
              named_params: []
            )
          ],
          named_params: []
        ),
        patterns: [
          tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(tag_ptrn)))
        ]
      )
    ],
    exprs: [fn_par(0)]
  ),
  res_type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var)))
)
