syn_fn_def(
  name: fn_symbol(simplify),
  params: [(type: type_ref(type_symbol(expr)), var: var(expr))],
  local_fns: [
    syn_fn_def(
      name: fn_symbol(make),
      params: [(type: type_ref(type_symbol(expr)), var: var(expr))],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: fn_call(
              name: fn_symbol(make),
              params: [
                object(select_expr_fn),
                accessor(expr: const_or_var(expr), field: object(src_expr)),
                accessor(expr: const_or_var(expr), field: object(ptrn)),
                if_expr(
                  else: const_or_var(obj_true),
                  branches: [
                    (
                      expr: accessor(expr: const_or_var(expr), field: object(cond)),
                      cond: accessor_test(expr: const_or_var(expr), field: object(cond))
                    )
                  ]
                ),
                accessor(expr: const_or_var(expr), field: object(expr))
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(select_expr))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(make),
              params: [
                object(replace_expr_fn),
                accessor(expr: const_or_var(expr), field: object(src_expr)),
                accessor(expr: const_or_var(expr), field: object(ptrn)),
                const_or_var(obj_true),
                accessor(expr: const_or_var(expr), field: object(expr))
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(replace_expr))
              )
            ]
          )
        ],
        exprs: [fn_par(0)]
      ),
      res_type: type_ref(type_symbol(expr))
    ),
    syn_fn_def(
      name: fn_symbol(make),
      params: [
        (type: type_ref(type_symbol(atom)), var: var(fn_name)),
        (type: type_ref(type_symbol(expr)), var: var(src_expr)),
        (type: type_ref(type_symbol(pattern)), var: var(ptrn)),
        (type: type_ref(type_symbol(expr)), var: var(sel_expr)),
        (type: type_ref(type_symbol(expr)), var: var(expr))
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(
            value: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: seq_expr(
                      head: [
                        fn_call(
                          name: fn_symbol(fn_par),
                          params: [object(0)],
                          named_params: []
                        )
                      ]
                    ),
                    key: object(exprs)
                  ),
                  (
                    value: seq_expr(
                      head: [
                        map_expr(
                          {
                            (value: const_or_var(sel_expr), key: object(expr)),
                            (
                              value: seq_expr(head: [const_or_var(ptrn)]),
                              key: object(ptrns)
                            )
                          }
                        ),
                        map_expr(
                          {
                            (value: const_or_var(obj_false), key: object(expr)),
                            (
                              value: seq_expr(
                                head: [
                                  tag_obj_expr(obj: object(type_any), tag: object(type_ptrn))
                                ]
                              ),
                              key: object(ptrns)
                            )
                          }
                        )
                      ]
                    ),
                    key: object(cases)
                  )
                }
              ),
              tag: object(match_expr)
            ),
            var: var(cond_expr)
          ),
          assignment_stmt(
            value: tag_obj_expr(
              obj: map_expr(
                {
                  (value: seq_expr(head: [object(nil)]), key: object(params)),
                  (value: const_or_var(cond_expr), key: object(expr))
                }
              ),
              tag: object(cls_expr)
            ),
            var: var(cond_cls)
          ),
          assignment_stmt(
            value: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: seq_expr(
                      head: [
                        fn_call(
                          name: fn_symbol(fn_par),
                          params: [object(0)],
                          named_params: []
                        )
                      ]
                    ),
                    key: object(exprs)
                  ),
                  (
                    value: seq_expr(
                      head: [
                        map_expr(
                          {
                            (value: const_or_var(expr), key: object(expr)),
                            (
                              value: seq_expr(head: [const_or_var(ptrn)]),
                              key: object(ptrns)
                            )
                          }
                        )
                      ]
                    ),
                    key: object(cases)
                  )
                }
              ),
              tag: object(match_expr)
            ),
            var: var(eval_expr)
          ),
          assignment_stmt(
            value: tag_obj_expr(
              obj: map_expr(
                {
                  (value: seq_expr(head: [object(nil)]), key: object(params)),
                  (value: const_or_var(eval_expr), key: object(expr))
                }
              ),
              tag: object(cls_expr)
            ),
            var: var(eval_cls)
          ),
          assignment_stmt(
            value: map_expr(
              {
                (
                  value: const_or_var(cond_cls),
                  key: tag_obj_expr(obj: object(condition), tag: object(named_par))
                ),
                (
                  value: const_or_var(eval_cls),
                  key: tag_obj_expr(obj: object(eval), tag: object(named_par))
                )
              }
            ),
            var: var(nps)
          ),
          return_stmt(
            tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: seq_expr(head: [const_or_var(src_expr)]),
                    key: object(params)
                  ),
                  (value: const_or_var(nps), key: object(named_params)),
                  (
                    value: tag_obj_expr(obj: const_or_var(fn_name), tag: object(fn_symbol)),
                    key: object(name)
                  )
                }
              ),
              tag: object(fn_call)
            )
          )
        ]
      ),
      res_type: type_ref(type_symbol(expr))
    )
  ],
  expr: do_expr(
    [
      return_stmt(
        fn_call(
          name: fn_symbol(make),
          params: [const_or_var(expr)],
          named_params: []
        )
      )
    ]
  ),
  res_type: type_ref(type_symbol(expr))
)
