syn_fn_def(
  name: fn_symbol(inst_par_type),
  params: [
    (type: type_ref(type_symbol(partypesymbol)), var: var(symb)),
    (
      type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synpartypedef))
      ),
      var: var(par_tdefs)
    )
  ],
  local_fns: [],
  expr: do_expr(
    [
      assignment_stmt(
        value: fn_call(
          name: fn_symbol(length),
          params: [accessor(expr: const_or_var(symb), field: object(params))],
          named_params: []
        ),
        var: var(arity)
      ),
      assignment_stmt(
        value: fn_call(
          name: fn_symbol(only_element),
          params: [
            set_comp(
              sel_exprs: [
                eq(
                  left: accessor(expr: const_or_var(d), field: object(name)),
                  right: accessor(expr: const_or_var(symb), field: object(symbol))
                ),
                eq(
                  left: fn_call(
                    name: fn_symbol(length),
                    params: [accessor(expr: const_or_var(d), field: object(params))],
                    named_params: []
                  ),
                  right: const_or_var(arity)
                )
              ],
              source: [
                in_clause(src: const_or_var(par_tdefs), ptrn: var_ptrn(name: var(d)))
              ],
              expr: const_or_var(d)
            )
          ],
          named_params: []
        ),
        var: var(par_tdef)
      ),
      return_stmt(
        replace_expr(
          ptrn: var_ptrn(
            name: var(v),
            ptrn: type_ptrn(type_ref(type_symbol(typevar)))
          ),
          expr: fn_call(
            name: op_symbol(brackets),
            params: [
              accessor(expr: const_or_var(symb), field: object(params)),
              fn_call(
                name: fn_symbol(index_first),
                params: [
                  const_or_var(v),
                  accessor(expr: const_or_var(par_tdef), field: object(params))
                ],
                named_params: []
              )
            ],
            named_params: []
          ),
          src_expr: accessor(expr: const_or_var(par_tdef), field: object(type))
        )
      )
    ]
  ),
  res_type: type_ref(type_symbol(syntype))
)
