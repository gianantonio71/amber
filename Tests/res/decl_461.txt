using_block(
  fn_defs: [
    syn_fn_def(
      name: fn_symbol(type_is_wf),
      params: [
        (type: type_ref(type_symbol(type)), var: var(type)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(typevar))),
          var: var(type_vars)
        )
      ],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: object(true),
            patterns: [type_ptrn(type_ref(type_symbol(leaftype)))]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(has_key),
              params: [const_or_var(typedefs), const_or_var(ts)],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(ts)),
                tag: obj_ptrn(object(type_ref))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: not(
                        fn_call(
                          name: fn_symbol(in),
                          params: [const_or_var(type), const_or_var(type_vars)],
                          named_params: []
                        )
                      ),
                      body: [
                        print_stmt(
                          fn_call(
                            name: op_symbol(amp),
                            params: [
                              tag_obj_expr(
                                obj: seq_expr(
                                  head: [
                                    object(77),
                                    object(105),
                                    object(115),
                                    object(115),
                                    object(105),
                                    object(110),
                                    object(103),
                                    object(32),
                                    object(116),
                                    object(121),
                                    object(112),
                                    object(101),
                                    object(32),
                                    object(118),
                                    object(97),
                                    object(114),
                                    object(58),
                                    object(32)
                                  ]
                                ),
                                tag: object(string)
                              ),
                              builtin_call(name: str, params: [const_or_var(a)])
                            ],
                            named_params: []
                          )
                        )
                      ]
                    )
                  ]
                ),
                return_stmt(object(true))
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(a)),
                tag: obj_ptrn(object(type_var))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(type_is_wf),
              params: [
                accessor(expr: const_or_var(type), field: object(elem_type)),
                const_or_var(type_vars)
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(seq_type)))
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(all),
              params: [
                seq_comp(
                  var: var(t),
                  expr: fn_call(
                    name: fn_symbol(type_is_wf),
                    params: [const_or_var(t), const_or_var(type_vars)],
                    named_params: []
                  ),
                  src_expr: const_or_var(ts)
                )
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(ts)),
                tag: obj_ptrn(object(fixed_seq_type))
              )
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(type_is_wf),
              params: [
                accessor(expr: const_or_var(type), field: object(elem_type)),
                const_or_var(type_vars)
              ],
              named_params: []
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(set_type)))
            ]
          ),
          case(
            expr: and(
              left: fn_call(
                name: fn_symbol(type_is_wf),
                params: [
                  accessor(expr: const_or_var(type), field: object(key_type)),
                  const_or_var(type_vars)
                ],
                named_params: []
              ),
              right: fn_call(
                name: fn_symbol(type_is_wf),
                params: [
                  accessor(expr: const_or_var(type), field: object(value_type)),
                  const_or_var(type_vars)
                ],
                named_params: []
              )
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(map_type)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(apply),
                    params: [const_or_var(bs)],
                    named_params: [
                      syn_fn_def(
                        name: fn_symbol(f),
                        params: [(var: var(b))],
                        local_fns: [],
                        expr: accessor(expr: const_or_var(b), field: object(label))
                      )
                    ]
                  ),
                  var: var(ls)
                ),
                return_stmt(
                  and(
                    left: not(
                      ex_qual(
                        sel_exprs: [
                          fn_call(
                            name: op_symbol(greater),
                            params: [const_or_var(c), object(1)],
                            named_params: []
                          )
                        ],
                        source: [
                          map_in_clause(
                            src: const_or_var(ls),
                            value_ptrn: var_ptrn(name: var(c)),
                            key_ptrn: var_ptrn(name: var(l))
                          )
                        ]
                      )
                    ),
                    right: not(
                      ex_qual(
                        sel_exprs: [
                          not(
                            fn_call(
                              name: fn_symbol(type_is_wf),
                              params: [
                                accessor(expr: const_or_var(b), field: object(type)),
                                const_or_var(type_vars)
                              ],
                              named_params: []
                            )
                          )
                        ],
                        source: [
                          in_clause(src: const_or_var(bs), ptrn: var_ptrn(name: var(b)))
                        ]
                      )
                    )
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(bs)),
                tag: obj_ptrn(object(tuple_type))
              )
            ]
          ),
          case(
            expr: and(
              left: fn_call(
                name: fn_symbol(type_is_wf),
                params: [
                  accessor(expr: const_or_var(type), field: object(tag_type)),
                  const_or_var(type_vars)
                ],
                named_params: []
              ),
              right: fn_call(
                name: fn_symbol(type_is_wf),
                params: [
                  accessor(expr: const_or_var(type), field: object(obj_type)),
                  const_or_var(type_vars)
                ],
                named_params: []
              )
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(tag_type)))
            ]
          ),
          case(
            expr: and(
              left: and(
                left: and(
                  left: fn_call(
                    name: op_symbol(greater_eq),
                    params: [
                      fn_call(
                        name: fn_symbol(size),
                        params: [const_or_var(ts)],
                        named_params: []
                      ),
                      object(2)
                    ],
                    named_params: []
                  ),
                  right: not(
                    ex_qual(
                      sel_exprs: [],
                      source: [
                        in_clause(
                          src: const_or_var(ts),
                          ptrn: type_ptrn(type_ref(type_symbol(uniontype)))
                        )
                      ]
                    )
                  )
                ),
                right: not(
                  ex_qual(
                    sel_exprs: [
                      not(
                        fn_call(
                          name: fn_symbol(type_is_wf),
                          params: [const_or_var(t), const_or_var(type_vars)],
                          named_params: []
                        )
                      )
                    ],
                    source: [
                      in_clause(src: const_or_var(ts), ptrn: var_ptrn(name: var(t)))
                    ]
                  )
                )
              ),
              right: not(
                ex_qual(
                  sel_exprs: [
                    neq(left: const_or_var(t1), right: const_or_var(t2)),
                    not(
                      fn_call(
                        name: fn_symbol(are_compatible),
                        params: [const_or_var(t1), const_or_var(t2)],
                        named_params: []
                      )
                    )
                  ],
                  source: [
                    in_clause(src: const_or_var(ts), ptrn: var_ptrn(name: var(t1))),
                    in_clause(src: const_or_var(ts), ptrn: var_ptrn(name: var(t2)))
                  ]
                )
              )
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(ts)),
                tag: obj_ptrn(object(union_type))
              )
            ]
          )
        ],
        exprs: [fn_par(0), fn_par(1)]
      ),
      res_type: type_ref(type_symbol(tautology))
    )
  ],
  signatures: [
    syn_sgn(
      name: fn_symbol(typedefs),
      params: [],
      res_type: map_type(
        value_type: type_ref(type_symbol(type)),
        key_type: type_ref(type_symbol(typesymbol))
      )
    )
  ]
)
