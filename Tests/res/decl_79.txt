syn_fn_def(
  name: op_symbol(amp),
  params: [
    (
      type: map_type(value_type: type_var(t2), key_type: type_var(t1)),
      var: var(map1)
    ),
    (
      type: map_type(value_type: type_var(t2), key_type: type_var(t1)),
      var: var(map2)
    )
  ],
  local_fns: [],
  expr: do_expr(
    [
      assert_stmt(
        do_expr(
          [
            assignment_stmt(
              value: fn_call(
                name: fn_symbol(keys),
                params: [const_or_var(map1)],
                named_params: []
              ),
              var: var(ks1)
            ),
            assignment_stmt(
              value: fn_call(
                name: fn_symbol(keys),
                params: [const_or_var(map2)],
                named_params: []
              ),
              var: var(ks2)
            ),
            for_stmt(
              body: [
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: neq(
                        left: fn_call(
                          name: op_symbol(brackets),
                          params: [const_or_var(map1), const_or_var(k)],
                          named_params: []
                        ),
                        right: fn_call(
                          name: op_symbol(brackets),
                          params: [const_or_var(map2), const_or_var(k)],
                          named_params: []
                        )
                      ),
                      body: [return_stmt(object(false))]
                    )
                  ]
                )
              ],
              loops: [
                seq_iter(
                  var: var(k),
                  values: fn_call(
                    name: fn_symbol(rand_sort),
                    params: [
                      fn_call(
                        name: fn_symbol(intersection),
                        params: [const_or_var(ks1), const_or_var(ks2)],
                        named_params: []
                      )
                    ],
                    named_params: []
                  )
                )
              ]
            ),
            return_stmt(object(true))
          ]
        )
      ),
      return_stmt(
        map_comp(
          sel_exprs: [],
          source: [
            or_clause(
              left: map_in_clause(
                src: const_or_var(map1),
                value_ptrn: var_ptrn(name: var(v)),
                key_ptrn: var_ptrn(name: var(k))
              ),
              right: map_in_clause(
                src: const_or_var(map2),
                value_ptrn: var_ptrn(name: var(v)),
                key_ptrn: var_ptrn(name: var(k))
              )
            )
          ],
          value_expr: const_or_var(v),
          key_expr: const_or_var(k)
        )
      )
    ]
  ),
  res_type: map_type(value_type: type_var(t2), key_type: type_var(t1))
)
