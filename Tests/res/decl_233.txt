syn_fn_def(
  name: fn_symbol(scalar_vars),
  params: [(type: type_ref(type_symbol(fndef)), var: var(fn_def))],
  local_fns: [],
  expr: fn_call(
    name: op_symbol(amp),
    params: [
      fn_call(
        name: op_symbol(amp),
        params: [
          set_comp(
            sel_exprs: [
              and(
                left: accessor_test(expr: const_or_var(p), field: object(var)),
                right: or(
                  left: not(accessor_test(expr: const_or_var(p), field: object(type))),
                  right: membership(
                    type: type_ref(type_symbol(type)),
                    obj: accessor(expr: const_or_var(p), field: object(type))
                  )
                )
              )
            ],
            source: [
              in_clause(
                src: fn_call(
                  name: fn_symbol(set),
                  params: [
                    accessor(expr: const_or_var(fn_def), field: object(params))
                  ],
                  named_params: []
                ),
                ptrn: var_ptrn(name: var(p))
              )
            ],
            expr: accessor(expr: const_or_var(p), field: object(var))
          ),
          fn_call(
            name: fn_symbol(set),
            params: [
              seq_comp(
                var: var(p),
                expr: tag_obj_expr(obj: const_or_var(i), tag: object(fn_par)),
                idx_var: var(i),
                src_expr: accessor(expr: const_or_var(fn_def), field: object(params)),
                sel_expr: or(
                  left: not(accessor_test(expr: const_or_var(p), field: object(type))),
                  right: membership(
                    type: type_ref(type_symbol(type)),
                    obj: accessor(expr: const_or_var(p), field: object(type))
                  )
                )
              )
            ],
            named_params: []
          )
        ],
        named_params: []
      ),
      set_comp(
        sel_exprs: [],
        source: [
          map_in_clause(
            src: accessor(expr: const_or_var(fn_def), field: object(named_params)),
            value_ptrn: var_ptrn(name: var(t), ptrn: type_ptrn(type_ref(type_symbol(type)))),
            key_ptrn: var_ptrn(name: var(v))
          )
        ],
        expr: const_or_var(v)
      )
    ],
    named_params: []
  ),
  res_type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var)))
)
