using_block(
  fn_defs: [
    syn_fn_def(
      name: fn_symbol(sort_set),
      params: [
        (
          type: set_type(nonempty: false, elem_type: type_var(t)),
          var: var(s)
        )
      ],
      local_fns: [],
      expr: fn_call(
        name: fn_symbol(sort),
        params: [
          fn_call(
            name: fn_symbol(rand_sort),
            params: [const_or_var(s)],
            named_params: []
          )
        ],
        named_params: []
      ),
      res_type: seq_type(nonempty: false, elem_type: type_var(t))
    ),
    syn_fn_def(
      name: fn_symbol(sort),
      params: [
        (
          type: seq_type(nonempty: false, elem_type: type_var(t)),
          var: var(s)
        )
      ],
      local_fns: [],
      expr: fn_call(
        name: fn_symbol(mergesort),
        params: [const_or_var(s)],
        named_params: []
      ),
      res_type: seq_type(nonempty: false, elem_type: type_var(t))
    ),
    syn_fn_def(
      name: fn_symbol(mergesort),
      params: [
        (
          type: seq_type(nonempty: false, elem_type: type_var(t)),
          var: var(seq)
        )
      ],
      local_fns: [
        syn_fn_def(
          name: fn_symbol(merge),
          params: [
            (
              type: seq_type(nonempty: false, elem_type: type_var(t)),
              var: var(seq1)
            ),
            (
              type: seq_type(nonempty: false, elem_type: type_var(t)),
              var: var(seq2)
            )
          ],
          local_fns: [],
          expr: do_expr(
            [
              assignment_stmt(
                value: fn_call(
                  name: fn_symbol(length),
                  params: [const_or_var(seq1)],
                  named_params: []
                ),
                var: var(l1)
              ),
              assignment_stmt(
                value: fn_call(
                  name: fn_symbol(length),
                  params: [const_or_var(seq2)],
                  named_params: []
                ),
                var: var(l2)
              ),
              assignment_stmt(value: seq_expr(head: []), var: var(rs)),
              assignment_stmt(value: object(0), var: var(i1)),
              assignment_stmt(value: object(0), var: var(i2)),
              loop_stmt(
                cond: or(
                  left: fn_call(
                    name: op_symbol(lower),
                    params: [const_or_var(i1), const_or_var(l1)],
                    named_params: []
                  ),
                  right: fn_call(
                    name: op_symbol(lower),
                    params: [const_or_var(i2), const_or_var(l2)],
                    named_params: []
                  )
                ),
                body: [
                  if_stmt(
                    else: [
                      assignment_stmt(
                        value: seq_expr(
                          head: [
                            fn_call(
                              name: op_symbol(brackets),
                              params: [const_or_var(seq1), const_or_var(i1)],
                              named_params: []
                            )
                          ],
                          tail: const_or_var(rs)
                        ),
                        var: var(rs)
                      ),
                      assignment_stmt(
                        value: fn_call(
                          name: op_symbol(plus),
                          params: [const_or_var(i1), object(1)],
                          named_params: []
                        ),
                        var: var(i1)
                      )
                    ],
                    branches: [
                      (
                        cond: or(
                          left: eq(left: const_or_var(i1), right: const_or_var(l1)),
                          right: and(
                            left: fn_call(
                              name: op_symbol(lower),
                              params: [const_or_var(i2), const_or_var(l2)],
                              named_params: []
                            ),
                            right: fn_call(
                              name: fn_symbol(is_strictly_ordered),
                              params: [
                                fn_call(
                                  name: op_symbol(brackets),
                                  params: [const_or_var(seq2), const_or_var(i2)],
                                  named_params: []
                                ),
                                fn_call(
                                  name: op_symbol(brackets),
                                  params: [const_or_var(seq1), const_or_var(i1)],
                                  named_params: []
                                )
                              ],
                              named_params: []
                            )
                          )
                        ),
                        body: [
                          assignment_stmt(
                            value: seq_expr(
                              head: [
                                fn_call(
                                  name: op_symbol(brackets),
                                  params: [const_or_var(seq2), const_or_var(i2)],
                                  named_params: []
                                )
                              ],
                              tail: const_or_var(rs)
                            ),
                            var: var(rs)
                          ),
                          assignment_stmt(
                            value: fn_call(
                              name: op_symbol(plus),
                              params: [const_or_var(i2), object(1)],
                              named_params: []
                            ),
                            var: var(i2)
                          )
                        ]
                      )
                    ]
                  )
                ],
                skip_first: false
              ),
              assert_stmt(
                and(
                  left: fn_call(
                    name: op_symbol(lower_eq),
                    params: [const_or_var(i1), const_or_var(l1)],
                    named_params: []
                  ),
                  right: fn_call(
                    name: op_symbol(lower_eq),
                    params: [const_or_var(i2), const_or_var(l2)],
                    named_params: []
                  )
                )
              ),
              return_stmt(
                fn_call(
                  name: fn_symbol(reverse),
                  params: [const_or_var(rs)],
                  named_params: []
                )
              )
            ]
          ),
          res_type: seq_type(nonempty: false, elem_type: type_var(t))
        )
      ],
      expr: do_expr(
        [
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(length),
              params: [const_or_var(seq)],
              named_params: []
            ),
            var: var(len)
          ),
          if_stmt(
            else: [],
            branches: [
              (
                cond: fn_call(
                  name: op_symbol(lower_eq),
                  params: [const_or_var(len), object(1)],
                  named_params: []
                ),
                body: [return_stmt(const_or_var(seq))]
              )
            ]
          ),
          assignment_stmt(
            value: seq_comp(
              var: var(x),
              expr: seq_expr(head: [const_or_var(x)]),
              src_expr: const_or_var(seq)
            ),
            var: var(ss)
          ),
          loop_stmt(
            cond: fn_call(
              name: op_symbol(greater),
              params: [const_or_var(len), object(1)],
              named_params: []
            ),
            body: [
              assignment_stmt(value: seq_expr(head: []), var: var(nss)),
              assignment_stmt(value: object(0), var: var(idx)),
              loop_stmt(
                cond: fn_call(
                  name: op_symbol(greater),
                  params: [
                    const_or_var(len),
                    fn_call(
                      name: op_symbol(plus),
                      params: [const_or_var(idx), object(1)],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                body: [
                  assignment_stmt(
                    value: seq_expr(
                      head: [
                        fn_call(
                          name: fn_symbol(merge),
                          params: [
                            fn_call(
                              name: op_symbol(brackets),
                              params: [const_or_var(ss), const_or_var(idx)],
                              named_params: []
                            ),
                            fn_call(
                              name: op_symbol(brackets),
                              params: [
                                const_or_var(ss),
                                fn_call(
                                  name: op_symbol(plus),
                                  params: [const_or_var(idx), object(1)],
                                  named_params: []
                                )
                              ],
                              named_params: []
                            )
                          ],
                          named_params: []
                        )
                      ],
                      tail: const_or_var(nss)
                    ),
                    var: var(nss)
                  ),
                  assignment_stmt(
                    value: fn_call(
                      name: op_symbol(plus),
                      params: [const_or_var(idx), object(2)],
                      named_params: []
                    ),
                    var: var(idx)
                  )
                ],
                skip_first: false
              ),
              assert_stmt(
                or(
                  left: eq(
                    left: const_or_var(idx),
                    right: fn_call(
                      name: fn_symbol(length),
                      params: [const_or_var(ss)],
                      named_params: []
                    )
                  ),
                  right: eq(
                    left: const_or_var(idx),
                    right: fn_call(
                      name: op_symbol(minus),
                      params: [
                        fn_call(
                          name: fn_symbol(length),
                          params: [const_or_var(ss)],
                          named_params: []
                        ),
                        object(1)
                      ],
                      named_params: []
                    )
                  )
                )
              ),
              assignment_stmt(
                value: if_expr(
                  else: const_or_var(nss),
                  branches: [
                    (
                      expr: seq_expr(
                        head: [
                          fn_call(
                            name: op_symbol(brackets),
                            params: [const_or_var(ss), const_or_var(idx)],
                            named_params: []
                          )
                        ],
                        tail: const_or_var(nss)
                      ),
                      cond: fn_call(
                        name: op_symbol(greater),
                        params: [const_or_var(len), const_or_var(idx)],
                        named_params: []
                      )
                    )
                  ]
                ),
                var: var(ss)
              ),
              assignment_stmt(
                value: fn_call(
                  name: fn_symbol(length),
                  params: [const_or_var(ss)],
                  named_params: []
                ),
                var: var(len)
              )
            ],
            skip_first: false
          ),
          return_stmt(
            fn_call(
              name: op_symbol(brackets),
              params: [const_or_var(ss), object(0)],
              named_params: []
            )
          )
        ]
      ),
      res_type: seq_type(nonempty: false, elem_type: type_var(t))
    )
  ],
  signatures: [
    syn_sgn(
      name: fn_symbol(is_strictly_ordered),
      params: [type_var(t), type_var(t)],
      res_type: type_ref(type_symbol(bool))
    )
  ]
)
