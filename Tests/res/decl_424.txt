using_block(
  fn_defs: [
    syn_fn_def(
      name: fn_symbol(fndef_wf_errors),
      params: [
        (type: type_ref(type_symbol(synfndef)), var: var(fn_def)),
        (
          type: set_type(
            nonempty: false,
            elem_type: type_ref(type_symbol(untypedsgn))
          ),
          var: var(global_fns)
        ),
        (
          type: set_type(
            nonempty: false,
            elem_type: type_ref(type_symbol(basicuntypedsgn))
          ),
          var: var(impl_pars)
        )
      ],
      local_fns: [],
      expr: fn_call(
        name: fn_symbol(fndef_wf_errors),
        params: [
          const_or_var(fn_def),
          const_or_var(global_fns),
          set_expr({}),
          const_or_var(impl_pars)
        ],
        named_params: []
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    ),
    syn_fn_def(
      name: fn_symbol(fndef_wf_errors),
      params: [
        (type: type_ref(type_symbol(synfndef)), var: var(fn_def)),
        (
          type: set_type(
            nonempty: false,
            elem_type: type_ref(type_symbol(untypedsgn))
          ),
          var: var(global_fns)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(typevar))),
          var: var(type_vars)
        ),
        (
          type: set_type(
            nonempty: false,
            elem_type: type_ref(type_symbol(basicuntypedsgn))
          ),
          var: var(impl_pars)
        )
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(set),
              params: [
                seq_comp(
                  var: var(i),
                  expr: tag_obj_expr(obj: const_or_var(i), tag: object(fn_par)),
                  src_expr: fn_call(
                    name: fn_symbol(inc_seq),
                    params: [
                      fn_call(
                        name: fn_symbol(length),
                        params: [
                          accessor(expr: const_or_var(fn_def), field: object(params))
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  )
                )
              ],
              named_params: []
            ),
            var: var(vs)
          ),
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(merge_and_override),
              params: [
                const_or_var(global_fns),
                set_comp(
                  sel_exprs: [],
                  source: [
                    in_clause(
                      src: fn_call(
                        name: fn_symbol(set),
                        params: [
                          accessor(expr: const_or_var(fn_def), field: object(local_fns))
                        ],
                        named_params: []
                      ),
                      ptrn: var_ptrn(name: var(lfd))
                    )
                  ],
                  expr: fn_call(
                    name: fn_symbol(untyped_sgn),
                    params: [const_or_var(lfd)],
                    named_params: []
                  )
                )
              ],
              named_params: []
            ),
            var: var(all_fns)
          ),
          assignment_stmt(
            value: fn_call(
              name: op_symbol(amp),
              params: [
                const_or_var(type_vars),
                select_expr(
                  type: type_ref(type_symbol(typevar)),
                  src_expr: accessor(expr: const_or_var(fn_def), field: object(params))
                )
              ],
              named_params: []
            ),
            var: var(ts)
          ),
          assignment_stmt(value: set_expr({}), var: var(sgn_errs)),
          for_stmt(
            body: [
              if_stmt(
                else: [],
                branches: [
                  (
                    cond: accessor_test(expr: const_or_var(p), field: object(type)),
                    body: [
                      assignment_stmt(
                        value: fn_call(
                          name: op_symbol(amp),
                          params: [
                            const_or_var(sgn_errs),
                            fn_call(
                              name: fn_symbol(type_wf_errors),
                              params: [accessor(expr: const_or_var(p), field: object(type))],
                              named_params: [
                                syn_fn_def(
                                  name: fn_symbol(type_vars_in_scope),
                                  params: [],
                                  local_fns: [],
                                  expr: const_or_var(ts)
                                )
                              ]
                            )
                          ],
                          named_params: []
                        ),
                        var: var(sgn_errs)
                      )
                    ]
                  )
                ]
              ),
              if_stmt(
                else: [],
                branches: [
                  (
                    cond: accessor_test(expr: const_or_var(p), field: object(var)),
                    body: [
                      if_stmt(
                        else: [],
                        branches: [
                          (
                            cond: fn_call(
                              name: fn_symbol(in),
                              params: [
                                accessor(expr: const_or_var(p), field: object(var)),
                                const_or_var(vs)
                              ],
                              named_params: []
                            ),
                            body: [
                              assignment_stmt(
                                value: fn_call(
                                  name: op_symbol(amp),
                                  params: [
                                    const_or_var(sgn_errs),
                                    set_expr(
                                      {
                                        tag_obj_expr(
                                          obj: accessor(expr: const_or_var(p), field: object(var)),
                                          tag: object(var_redef)
                                        )
                                      }
                                    )
                                  ],
                                  named_params: []
                                ),
                                var: var(sgn_errs)
                              )
                            ]
                          )
                        ]
                      ),
                      assignment_stmt(
                        value: fn_call(
                          name: op_symbol(amp),
                          params: [
                            const_or_var(vs),
                            set_expr({accessor(expr: const_or_var(p), field: object(var))})
                          ],
                          named_params: []
                        ),
                        var: var(vs)
                      )
                    ]
                  )
                ]
              )
            ],
            loops: [
              seq_iter(
                var: var(p),
                values: accessor(expr: const_or_var(fn_def), field: object(params))
              )
            ]
          ),
          assignment_stmt(
            value: if_expr(
              else: set_expr({}),
              branches: [
                (
                  expr: fn_call(
                    name: fn_symbol(type_wf_errors),
                    params: [
                      accessor(expr: const_or_var(fn_def), field: object(res_type))
                    ],
                    named_params: [
                      syn_fn_def(
                        name: fn_symbol(type_vars_in_scope),
                        params: [],
                        local_fns: [],
                        expr: const_or_var(ts)
                      )
                    ]
                  ),
                  cond: accessor_test(expr: const_or_var(fn_def), field: object(res_type))
                )
              ]
            ),
            var: var(ret_type_errs)
          ),
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(seq_union),
              params: [
                seq_comp(
                  var: var(fn),
                  expr: fn_call(
                    name: fn_symbol(fndef_wf_errors),
                    params: [
                      const_or_var(fn),
                      const_or_var(all_fns),
                      const_or_var(ts),
                      const_or_var(impl_pars)
                    ],
                    named_params: []
                  ),
                  src_expr: accessor(expr: const_or_var(fn_def), field: object(local_fns))
                )
              ],
              named_params: []
            ),
            var: var(loc_fns_errs)
          ),
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(expr_wf_errors),
              params: [
                accessor(expr: const_or_var(fn_def), field: object(expr)),
                const_or_var(vs)
              ],
              named_params: [
                syn_fn_def(
                  name: fn_symbol(fns_in_scope),
                  params: [],
                  local_fns: [],
                  expr: const_or_var(all_fns)
                ),
                syn_fn_def(
                  name: fn_symbol(type_vars_in_scope),
                  params: [],
                  local_fns: [],
                  expr: const_or_var(ts)
                ),
                syn_fn_def(
                  name: fn_symbol(impl_params),
                  params: [],
                  local_fns: [],
                  expr: const_or_var(impl_pars)
                )
              ]
            ),
            var: var(expr_errs)
          ),
          return_stmt(
            fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: op_symbol(amp),
                  params: [
                    fn_call(
                      name: op_symbol(amp),
                      params: [const_or_var(sgn_errs), const_or_var(ret_type_errs)],
                      named_params: []
                    ),
                    const_or_var(loc_fns_errs)
                  ],
                  named_params: []
                ),
                const_or_var(expr_errs)
              ],
              named_params: []
            )
          )
        ]
      ),
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(synobjerr))
      )
    )
  ],
  signatures: [
    syn_sgn(
      name: fn_symbol(typedefs),
      params: [],
      res_type: map_type(
        value_type: type_ref(type_symbol(syntype)),
        key_type: type_ref(type_symbol(typesymbol))
      )
    ),
    syn_sgn(
      name: fn_symbol(all_par_type_symbols),
      params: [],
      res_type: set_type(
        nonempty: false,
        elem_type: fixed_seq_type(
          [
            type_ref(type_symbol(basictypesymbol)),
            type_ref(type_symbol(nznat))
          ]
        )
      )
    )
  ]
)
