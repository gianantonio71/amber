syn_fn_def(
  name: fn_symbol(extern_vars),
  params: [(type: type_ref(type_symbol(statement)), var: var(s))],
  local_fns: [],
  expr: match_expr(
    cases: [
      case(
        expr: fn_call(
          name: fn_symbol(extern_vars),
          params: [accessor(expr: const_or_var(s), field: object(value))],
          named_params: []
        ),
        patterns: [
          tag_ptrn(
            obj: type_ptrn(type_any),
            tag: obj_ptrn(object(assignment_stmt))
          )
        ]
      ),
      case(
        expr: fn_call(
          name: fn_symbol(extern_vars),
          params: [const_or_var(e)],
          named_params: []
        ),
        patterns: [
          tag_ptrn(
            obj: var_ptrn(name: var(e)),
            tag: obj_ptrn(object(return_stmt))
          )
        ]
      ),
      case(
        expr: fn_call(
          name: op_symbol(amp),
          params: [
            fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(extern_vars),
                  params: [accessor(expr: const_or_var(s), field: object(cond))],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(extern_vars),
                  params: [accessor(expr: const_or_var(s), field: object(body))],
                  named_params: []
                )
              ],
              named_params: []
            ),
            fn_call(
              name: fn_symbol(extern_vars),
              params: [accessor(expr: const_or_var(s), field: object(else))],
              named_params: []
            )
          ],
          named_params: []
        ),
        patterns: [
          tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(if_stmt)))
        ]
      ),
      case(
        expr: fn_call(
          name: fn_symbol(extern_vars),
          params: [const_or_var(ss)],
          named_params: []
        ),
        patterns: [
          tag_ptrn(
            obj: var_ptrn(name: var(ss)),
            tag: obj_ptrn(object(loop_stmt))
          )
        ]
      ),
      case(
        expr: fn_call(
          name: op_symbol(amp),
          params: [
            fn_call(
              name: fn_symbol(extern_vars),
              params: [accessor(expr: const_or_var(s), field: object(values))],
              named_params: []
            ),
            fn_call(
              name: op_symbol(minus),
              params: [
                fn_call(
                  name: fn_symbol(extern_vars),
                  params: [accessor(expr: const_or_var(s), field: object(body))],
                  named_params: []
                ),
                set_expr(
                  {
                    accessor(expr: const_or_var(s), field: object(var)),
                    cond_expr(
                      expr: accessor(expr: const_or_var(s), field: object(idx_var)),
                      cond: accessor_test(expr: const_or_var(s), field: object(idx_var))
                    )
                  }
                )
              ],
              named_params: []
            )
          ],
          named_params: []
        ),
        patterns: [
          tag_ptrn(
            obj: type_ptrn(type_any),
            tag: obj_ptrn(object(foreach_stmt))
          )
        ]
      ),
      case(
        expr: fn_call(
          name: op_symbol(amp),
          params: [
            fn_call(
              name: op_symbol(amp),
              params: [
                fn_call(
                  name: fn_symbol(extern_vars),
                  params: [accessor(expr: const_or_var(s), field: object(start_val))],
                  named_params: []
                ),
                fn_call(
                  name: fn_symbol(extern_vars),
                  params: [accessor(expr: const_or_var(s), field: object(end_val))],
                  named_params: []
                )
              ],
              named_params: []
            ),
            fn_call(
              name: op_symbol(minus),
              params: [
                fn_call(
                  name: fn_symbol(extern_vars),
                  params: [accessor(expr: const_or_var(s), field: object(body))],
                  named_params: []
                ),
                set_expr({accessor(expr: const_or_var(s), field: object(var))})
              ],
              named_params: []
            )
          ],
          named_params: []
        ),
        patterns: [
          tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(for_stmt)))
        ]
      ),
      case(
        expr: set_expr({}),
        patterns: [obj_ptrn(object(break_stmt))]
      ),
      case(
        expr: set_expr({}),
        patterns: [obj_ptrn(object(fail_stmt))]
      ),
      case(
        expr: fn_call(
          name: fn_symbol(extern_vars),
          params: [const_or_var(e)],
          named_params: []
        ),
        patterns: [
          tag_ptrn(
            obj: var_ptrn(name: var(e)),
            tag: obj_ptrn(object(assert_stmt))
          )
        ]
      ),
      case(
        expr: fn_call(
          name: fn_symbol(extern_vars),
          params: [const_or_var(e)],
          named_params: []
        ),
        patterns: [
          tag_ptrn(
            obj: var_ptrn(name: var(e)),
            tag: obj_ptrn(object(print_stmt))
          )
        ]
      )
    ],
    exprs: [fn_par(0)]
  ),
  res_type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var)))
)
