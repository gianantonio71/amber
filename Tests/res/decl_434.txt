using_block(
  fn_defs: [
    syn_fn_def(
      name: fn_symbol(desugar_expr),
      params: [
        (type: type_ref(type_symbol(synexpr)), var: var(expr)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: const_or_var(expr),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(object)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: seq_comp(
                      var: var(e),
                      expr: fn_call(
                        name: fn_symbol(desugar_expr),
                        params: [const_or_var(e), const_or_var(def_vars)],
                        named_params: []
                      ),
                      src_expr: accessor(expr: const_or_var(expr), field: object(head))
                    ),
                    key: object(head)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(tail)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    cond: accessor_test(expr: const_or_var(expr), field: object(tail)),
                    key: object(tail)
                  )
                }
              ),
              tag: object(seq_expr)
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(seq_expr)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: set_comp(
                sel_exprs: [],
                source: [
                  in_clause(src: const_or_var(es), ptrn: var_ptrn(name: var(e)))
                ],
                expr: fn_call(
                  name: fn_symbol(desugar_expr),
                  params: [const_or_var(e), const_or_var(def_vars)],
                  named_params: []
                )
              ),
              tag: object(set_expr)
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(es)),
                tag: obj_ptrn(object(set_expr))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: set_comp(
                sel_exprs: [],
                source: [
                  in_clause(src: const_or_var(es), ptrn: var_ptrn(name: var(e)))
                ],
                expr: map_expr(
                  {
                    (
                      value: fn_call(
                        name: fn_symbol(desugar_expr),
                        params: [
                          accessor(expr: const_or_var(e), field: object(value)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      key: object(value)
                    ),
                    (
                      value: fn_call(
                        name: fn_symbol(desugar_expr),
                        params: [
                          accessor(expr: const_or_var(e), field: object(key)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      key: object(key)
                    ),
                    (
                      value: fn_call(
                        name: fn_symbol(desugar_expr),
                        params: [
                          accessor(expr: const_or_var(e), field: object(cond)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      cond: accessor_test(expr: const_or_var(e), field: object(cond)),
                      key: object(cond)
                    )
                  }
                )
              ),
              tag: object(map_expr)
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(es)),
                tag: obj_ptrn(object(map_expr))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(obj)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(obj)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(tag)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(tag)
                  )
                }
              ),
              tag: object(tag_obj_expr)
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(tag_obj_expr))
              )
            ]
          ),
          case(
            expr: const_or_var(expr),
            patterns: [type_ptrn(type_ref(type_symbol(var)))]
          ),
          case(
            expr: do_expr(
              [
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: fn_call(
                        name: fn_symbol(in),
                        params: [
                          tag_obj_expr(obj: const_or_var(a), tag: object(var)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      body: [
                        return_stmt(tag_obj_expr(obj: const_or_var(a), tag: object(var)))
                      ]
                    )
                  ]
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: fn_call(
                        name: fn_symbol(in),
                        params: [
                          tag_obj_expr(obj: const_or_var(a), tag: object(named_par)),
                          const_or_var(named_params)
                        ],
                        named_params: []
                      ),
                      body: [
                        return_stmt(tag_obj_expr(obj: const_or_var(a), tag: object(named_par)))
                      ]
                    )
                  ]
                ),
                assignment_stmt(
                  value: tag_obj_expr(
                    obj: map_expr(
                      {
                        (value: object(0), key: object(arity)),
                        (
                          value: tag_obj_expr(obj: const_or_var(a), tag: object(fn_symbol)),
                          key: object(name)
                        )
                      }
                    ),
                    tag: object(untyped_sgn)
                  ),
                  var: var(sgn)
                ),
                assert_stmt(
                  not(
                    fn_call(
                      name: fn_symbol(in),
                      params: [const_or_var(sgn), const_or_var(local_fns)],
                      named_params: []
                    )
                  )
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (value: seq_expr(head: []), key: object(params)),
                        (value: map_expr({}), key: object(named_params)),
                        (
                          value: tag_obj_expr(obj: const_or_var(a), tag: object(fn_symbol)),
                          key: object(name)
                        )
                      }
                    ),
                    tag: object(fn_call)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(a)),
                tag: obj_ptrn(object(const_or_var))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assert_stmt(
                  fn_call(
                    name: op_symbol(greater),
                    params: [
                      fn_call(
                        name: fn_symbol(length),
                        params: [accessor(expr: const_or_var(expr), field: object(params))],
                        named_params: []
                      ),
                      object(0)
                    ],
                    named_params: []
                  )
                ),
                assignment_stmt(
                  value: seq_comp(
                    var: var(e),
                    expr: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [const_or_var(e), const_or_var(def_vars)],
                      named_params: []
                    ),
                    src_expr: accessor(expr: const_or_var(expr), field: object(params))
                  ),
                  var: var(ps)
                ),
                assignment_stmt(
                  value: tag_obj_expr(
                    obj: map_expr(
                      {
                        (
                          value: accessor(expr: const_or_var(expr), field: object(name)),
                          key: object(name)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(length),
                            params: [accessor(expr: const_or_var(expr), field: object(params))],
                            named_params: []
                          ),
                          key: object(arity)
                        )
                      }
                    ),
                    tag: object(untyped_sgn)
                  ),
                  var: var(sgn)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(syn_fn_defs_to_named_params),
                    params: [
                      accessor(expr: const_or_var(expr), field: object(named_params)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(nps)
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: fn_call(
                        name: fn_symbol(in),
                        params: [const_or_var(sgn), const_or_var(local_fns)],
                        named_params: []
                      ),
                      body: [
                        assignment_stmt(
                          value: tag_obj_expr(
                            obj: map_expr(
                              {
                                (
                                  value: accessor(expr: const_or_var(expr), field: object(name)),
                                  key: object(inner)
                                ),
                                (value: const_or_var(curr_outer_fn), key: object(outer))
                              }
                            ),
                            tag: object(nested_fn_symbol)
                          ),
                          var: var(fs)
                        ),
                        return_stmt(
                          tag_obj_expr(
                            obj: map_expr(
                              {
                                (value: const_or_var(ps), key: object(params)),
                                (value: const_or_var(nps), key: object(named_params)),
                                (value: const_or_var(fs), key: object(name))
                              }
                            ),
                            tag: object(fn_call)
                          )
                        )
                      ]
                    )
                  ]
                ),
                assignment_stmt(
                  value: tag_obj_expr(
                    obj: fn_call(
                      name: fn_symbol(untag),
                      params: [accessor(expr: const_or_var(expr), field: object(name))],
                      named_params: []
                    ),
                    tag: object(named_par)
                  ),
                  var: var(np)
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: fn_call(
                        name: fn_symbol(in),
                        params: [const_or_var(np), const_or_var(named_params)],
                        named_params: []
                      ),
                      body: [
                        assert_stmt(eq(left: const_or_var(nps), right: map_expr({}))),
                        return_stmt(
                          tag_obj_expr(
                            obj: map_expr(
                              {
                                (value: const_or_var(ps), key: object(params)),
                                (value: const_or_var(np), key: object(name))
                              }
                            ),
                            tag: object(cls_call)
                          )
                        )
                      ]
                    )
                  ]
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (value: const_or_var(ps), key: object(params)),
                        (value: const_or_var(nps), key: object(named_params)),
                        (
                          value: accessor(expr: const_or_var(expr), field: object(name)),
                          key: object(name)
                        )
                      }
                    ),
                    tag: object(fn_call)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(fn_call)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: accessor(expr: const_or_var(expr), field: object(name)),
                    key: object(name)
                  ),
                  (
                    value: seq_comp(
                      var: var(e),
                      expr: fn_call(
                        name: fn_symbol(desugar_expr),
                        params: [const_or_var(e), const_or_var(def_vars)],
                        named_params: []
                      ),
                      src_expr: accessor(expr: const_or_var(expr), field: object(params))
                    ),
                    key: object(params)
                  )
                }
              ),
              tag: object(builtin_call)
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(builtin_call))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(left)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(left)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(right)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(right)
                  )
                }
              ),
              tag: object(and_expr)
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(and)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(left)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(left)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(right)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(right)
                  )
                }
              ),
              tag: object(or_expr)
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(or)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: fn_call(
                name: fn_symbol(desugar_expr),
                params: [const_or_var(e), const_or_var(def_vars)],
                named_params: []
              ),
              tag: object(not_expr)
            ),
            patterns: [
              tag_ptrn(obj: var_ptrn(name: var(e)), tag: obj_ptrn(object(not)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(left)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(left)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(right)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(right)
                  )
                }
              ),
              tag: object(eq)
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(eq)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: tag_obj_expr(
                obj: map_expr(
                  {
                    (
                      value: fn_call(
                        name: fn_symbol(desugar_expr),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(left)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      key: object(left)
                    ),
                    (
                      value: fn_call(
                        name: fn_symbol(desugar_expr),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(right)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      key: object(right)
                    )
                  }
                ),
                tag: object(eq)
              ),
              tag: object(not_expr)
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(neq)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: accessor(expr: const_or_var(expr), field: object(type)),
                    key: object(type)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(obj)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(obj)
                  )
                }
              ),
              tag: object(membership)
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(membership))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: accessor(expr: const_or_var(expr), field: object(field)),
                    key: object(field)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(expr)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(expr)
                  )
                }
              ),
              tag: object(accessor)
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(accessor)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: accessor(expr: const_or_var(expr), field: object(field)),
                    key: object(field)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(expr)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(expr)
                  )
                }
              ),
              tag: object(accessor_test)
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(accessor_test))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(def_vars),
                      fn_call(
                        name: fn_symbol(syn_new_vars),
                        params: [accessor(expr: const_or_var(expr), field: object(source))],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                assignment_stmt(
                  value: seq_comp(
                    var: var(e),
                    expr: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [const_or_var(e), const_or_var(vs)],
                      named_params: []
                    ),
                    src_expr: accessor(expr: const_or_var(expr), field: object(sel_exprs))
                  ),
                  var: var(se)
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (
                          value: fn_call(
                            name: fn_symbol(mk_and_clause),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(source)),
                              const_or_var(def_vars)
                            ],
                            named_params: []
                          ),
                          key: object(source)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(mk_and_expr),
                            params: [const_or_var(se)],
                            named_params: []
                          ),
                          cond: neq(left: const_or_var(se), right: seq_expr(head: [])),
                          key: object(sel_expr)
                        )
                      }
                    ),
                    tag: object(ex_qual)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(ex_qual)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(def_vars),
                      fn_call(
                        name: fn_symbol(syn_new_vars),
                        params: [accessor(expr: const_or_var(expr), field: object(source))],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                assignment_stmt(
                  value: seq_comp(
                    var: var(e),
                    expr: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [const_or_var(e), const_or_var(vs)],
                      named_params: []
                    ),
                    src_expr: accessor(expr: const_or_var(expr), field: object(sel_exprs))
                  ),
                  var: var(se)
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (
                          value: fn_call(
                            name: fn_symbol(desugar_expr),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(expr)),
                              const_or_var(vs)
                            ],
                            named_params: []
                          ),
                          key: object(expr)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(mk_and_clause),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(source)),
                              const_or_var(def_vars)
                            ],
                            named_params: []
                          ),
                          key: object(source)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(mk_and_expr),
                            params: [const_or_var(se)],
                            named_params: []
                          ),
                          cond: neq(left: const_or_var(se), right: seq_expr(head: [])),
                          key: object(sel_expr)
                        )
                      }
                    ),
                    tag: object(set_comp)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(set_comp)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(def_vars),
                      fn_call(
                        name: fn_symbol(syn_new_vars),
                        params: [accessor(expr: const_or_var(expr), field: object(source))],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                assignment_stmt(
                  value: seq_comp(
                    var: var(e),
                    expr: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [const_or_var(e), const_or_var(vs)],
                      named_params: []
                    ),
                    src_expr: accessor(expr: const_or_var(expr), field: object(sel_exprs))
                  ),
                  var: var(se)
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (
                          value: fn_call(
                            name: fn_symbol(mk_and_clause),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(source)),
                              const_or_var(def_vars)
                            ],
                            named_params: []
                          ),
                          key: object(source)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(desugar_expr),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(value_expr)),
                              const_or_var(vs)
                            ],
                            named_params: []
                          ),
                          key: object(value_expr)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(desugar_expr),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(key_expr)),
                              const_or_var(vs)
                            ],
                            named_params: []
                          ),
                          key: object(key_expr)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(mk_and_expr),
                            params: [const_or_var(se)],
                            named_params: []
                          ),
                          cond: neq(left: const_or_var(se), right: seq_expr(head: [])),
                          key: object(sel_expr)
                        )
                      }
                    ),
                    tag: object(map_comp)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(map_comp)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(def_vars),
                      set_expr(
                        {
                          accessor(expr: const_or_var(expr), field: object(var)),
                          cond_expr(
                            expr: accessor(expr: const_or_var(expr), field: object(idx_var)),
                            cond: accessor_test(expr: const_or_var(expr), field: object(idx_var))
                          )
                        }
                      )
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (
                          value: accessor(expr: const_or_var(expr), field: object(var)),
                          key: object(var)
                        ),
                        (
                          value: accessor(expr: const_or_var(expr), field: object(idx_var)),
                          cond: accessor_test(expr: const_or_var(expr), field: object(idx_var)),
                          key: object(idx_var)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(desugar_expr),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(expr)),
                              const_or_var(vs)
                            ],
                            named_params: []
                          ),
                          key: object(expr)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(desugar_expr),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(src_expr)),
                              const_or_var(def_vars)
                            ],
                            named_params: []
                          ),
                          key: object(src_expr)
                        ),
                        (
                          value: fn_call(
                            name: fn_symbol(desugar_expr),
                            params: [
                              accessor(expr: const_or_var(expr), field: object(sel_expr)),
                              const_or_var(vs)
                            ],
                            named_params: []
                          ),
                          cond: accessor_test(expr: const_or_var(expr), field: object(sel_expr)),
                          key: object(sel_expr)
                        )
                      }
                    ),
                    tag: object(seq_comp)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(seq_comp)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(desugar_expr),
                    params: [
                      accessor(expr: const_or_var(expr), field: object(else)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(res)
                ),
                for_stmt(
                  body: [
                    assignment_stmt(
                      value: tag_obj_expr(
                        obj: map_expr(
                          {
                            (value: const_or_var(res), key: object(else)),
                            (
                              value: fn_call(
                                name: fn_symbol(desugar_expr),
                                params: [
                                  accessor(expr: const_or_var(b), field: object(cond)),
                                  const_or_var(def_vars)
                                ],
                                named_params: []
                              ),
                              key: object(cond)
                            ),
                            (
                              value: fn_call(
                                name: fn_symbol(desugar_expr),
                                params: [
                                  accessor(expr: const_or_var(b), field: object(expr)),
                                  const_or_var(def_vars)
                                ],
                                named_params: []
                              ),
                              key: object(then)
                            )
                          }
                        ),
                        tag: object(if_expr)
                      ),
                      var: var(res)
                    )
                  ],
                  loops: [
                    seq_iter(
                      var: var(b),
                      values: fn_call(
                        name: fn_symbol(reverse),
                        params: [
                          accessor(expr: const_or_var(expr), field: object(branches))
                        ],
                        named_params: []
                      )
                    )
                  ]
                ),
                return_stmt(const_or_var(res))
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(if_expr)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(length),
                    params: [
                      accessor(
                        expr: fn_call(
                          name: op_symbol(brackets),
                          params: [
                            accessor(expr: const_or_var(expr), field: object(cases)),
                            object(0)
                          ],
                          named_params: []
                        ),
                        field: object(patterns)
                      )
                    ],
                    named_params: []
                  ),
                  var: var(n)
                ),
                assignment_stmt(
                  value: seq_comp(
                    var: var(e),
                    expr: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [const_or_var(e), const_or_var(def_vars)],
                      named_params: []
                    ),
                    src_expr: fn_call(
                      name: fn_symbol(subseq),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(exprs)),
                        object(0),
                        const_or_var(n)
                      ],
                      named_params: []
                    )
                  ),
                  var: var(es)
                ),
                assignment_stmt(
                  value: seq_comp(
                    var: var(c),
                    expr: do_expr(
                      [
                        assignment_stmt(
                          value: fn_call(
                            name: op_symbol(amp),
                            params: [
                              const_or_var(def_vars),
                              fn_call(
                                name: fn_symbol(seq_union),
                                params: [
                                  seq_comp(
                                    var: var(p),
                                    expr: fn_call(
                                      name: fn_symbol(new_vars),
                                      params: [const_or_var(p)],
                                      named_params: []
                                    ),
                                    src_expr: accessor(expr: const_or_var(c), field: object(patterns))
                                  )
                                ],
                                named_params: []
                              )
                            ],
                            named_params: []
                          ),
                          var: var(vs)
                        ),
                        return_stmt(
                          map_expr(
                            {
                              (
                                value: accessor(expr: const_or_var(c), field: object(patterns)),
                                key: object(ptrns)
                              ),
                              (
                                value: fn_call(
                                  name: fn_symbol(desugar_expr),
                                  params: [
                                    accessor(expr: const_or_var(c), field: object(expr)),
                                    const_or_var(vs)
                                  ],
                                  named_params: []
                                ),
                                key: object(expr)
                              )
                            }
                          )
                        )
                      ]
                    ),
                    src_expr: accessor(expr: const_or_var(expr), field: object(cases))
                  ),
                  var: var(cs)
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (value: const_or_var(es), key: object(exprs)),
                        (value: const_or_var(cs), key: object(cases))
                      }
                    ),
                    tag: object(match_expr)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(match_expr))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: fn_call(
                name: fn_symbol(desugar_stmts),
                params: [const_or_var(ss), const_or_var(def_vars)],
                named_params: []
              ),
              tag: object(do_expr)
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(ss)),
                tag: obj_ptrn(object(do_expr))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(first_unused_int_var),
                    params: [const_or_var(def_vars)],
                    named_params: []
                  ),
                  var: var(var)
                ),
                assignment_stmt(
                  value: tag_obj_expr(
                    obj: map_expr(
                      {
                        (value: const_or_var(var), key: object(name)),
                        (
                          value: tag_obj_expr(
                            obj: accessor(expr: const_or_var(expr), field: object(type)),
                            tag: object(type_ptrn)
                          ),
                          key: object(ptrn)
                        )
                      }
                    ),
                    tag: object(var_ptrn)
                  ),
                  var: var(ptrn)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(desugar_expr),
                    params: [
                      accessor(expr: const_or_var(expr), field: object(src_expr)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(src)
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (value: const_or_var(ptrn), key: object(ptrn)),
                        (value: const_or_var(var), key: object(expr)),
                        (value: const_or_var(src), key: object(src_expr))
                      }
                    ),
                    tag: object(select_expr)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(select_expr))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(def_vars),
                      fn_call(
                        name: fn_symbol(new_vars),
                        params: [accessor(expr: const_or_var(expr), field: object(ptrn))],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(vs)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(desugar_expr),
                    params: [
                      accessor(expr: const_or_var(expr), field: object(expr)),
                      const_or_var(vs)
                    ],
                    named_params: []
                  ),
                  var: var(res)
                ),
                assignment_stmt(
                  value: accessor(expr: const_or_var(expr), field: object(ptrn)),
                  var: var(ptrn)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(desugar_expr),
                    params: [
                      accessor(expr: const_or_var(expr), field: object(src_expr)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(src)
                ),
                assignment_stmt(
                  value: map_expr(
                    {
                      (value: const_or_var(ptrn), key: object(ptrn)),
                      (value: const_or_var(res), key: object(expr)),
                      (value: const_or_var(src), key: object(src_expr))
                    }
                  ),
                  var: var(tuple)
                ),
                if_stmt(
                  else: [],
                  branches: [
                    (
                      cond: accessor_test(expr: const_or_var(expr), field: object(cond)),
                      body: [
                        assignment_stmt(
                          value: fn_call(
                            name: op_symbol(amp),
                            params: [
                              const_or_var(tuple),
                              fn_call(
                                name: fn_symbol(desugar_expr),
                                params: [
                                  accessor(expr: const_or_var(expr), field: object(cond)),
                                  const_or_var(vs)
                                ],
                                named_params: []
                              )
                            ],
                            named_params: []
                          ),
                          var: var(tuple)
                        )
                      ]
                    )
                  ]
                ),
                return_stmt(
                  tag_obj_expr(obj: const_or_var(tuple), tag: object(select_expr))
                )
              ]
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(retrieve_expr))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: accessor(expr: const_or_var(expr), field: object(ptrn)),
                    key: object(ptrn)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(src_expr)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(src_expr)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(expr), field: object(expr)),
                        fn_call(
                          name: op_symbol(amp),
                          params: [
                            const_or_var(def_vars),
                            fn_call(
                              name: fn_symbol(new_vars),
                              params: [accessor(expr: const_or_var(expr), field: object(ptrn))],
                              named_params: []
                            )
                          ],
                          named_params: []
                        )
                      ],
                      named_params: []
                    ),
                    key: object(expr)
                  )
                }
              ),
              tag: object(replace_expr)
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(replace_expr))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: fn_call(
                name: fn_symbol(desugar_stmts),
                params: [
                  fn_call(
                    name: op_symbol(amp),
                    params: [
                      accessor(expr: const_or_var(expr), field: object(stmts)),
                      seq_expr(
                        head: [
                          tag_obj_expr(
                            obj: accessor(expr: const_or_var(expr), field: object(expr)),
                            tag: object(return_stmt)
                          )
                        ]
                      )
                    ],
                    named_params: []
                  ),
                  const_or_var(def_vars)
                ],
                named_params: []
              ),
              tag: object(do_expr)
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(let_expr)))
            ]
          )
        ],
        exprs: [fn_par(0), fn_par(1)]
      ),
      res_type: type_ref(type_symbol(expr))
    ),
    syn_fn_def(
      name: fn_symbol(desugar_expr),
      params: [
        (type: type_ref(type_symbol(syncondexpr)), var: var(cexpr)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: tag_obj_expr(
        obj: map_expr(
          {
            (
              value: fn_call(
                name: fn_symbol(desugar_expr),
                params: [
                  accessor(expr: const_or_var(cexpr), field: object(expr)),
                  const_or_var(def_vars)
                ],
                named_params: []
              ),
              key: object(expr)
            ),
            (
              value: fn_call(
                name: fn_symbol(desugar_expr),
                params: [
                  accessor(expr: const_or_var(cexpr), field: object(cond)),
                  const_or_var(def_vars)
                ],
                named_params: []
              ),
              key: object(cond)
            )
          }
        ),
        tag: object(cond_expr)
      ),
      res_type: type_ref(type_symbol(condexpr))
    ),
    syn_fn_def(
      name: fn_symbol(mk_and_expr),
      params: [
        (
          type: seq_type(nonempty: true, elem_type: type_ref(type_symbol(expr))),
          var: var(exprs)
        )
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(length),
              params: [const_or_var(exprs)],
              named_params: []
            ),
            var: var(len)
          ),
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(reverse),
              params: [const_or_var(exprs)],
              named_params: []
            ),
            var: var(rev_exprs)
          ),
          assignment_stmt(
            value: fn_call(
              name: op_symbol(brackets),
              params: [const_or_var(rev_exprs), object(0)],
              named_params: []
            ),
            var: var(expr)
          ),
          for_stmt(
            body: [
              assignment_stmt(
                value: tag_obj_expr(
                  obj: map_expr(
                    {
                      (value: const_or_var(expr), key: object(right)),
                      (
                        value: fn_call(
                          name: op_symbol(brackets),
                          params: [const_or_var(rev_exprs), const_or_var(i)],
                          named_params: []
                        ),
                        key: object(left)
                      )
                    }
                  ),
                  tag: object(and_expr)
                ),
                var: var(expr)
              )
            ],
            loops: [
              range_iter(
                var: var(i),
                end_val: fn_call(
                  name: op_symbol(minus),
                  params: [const_or_var(len), object(1)],
                  named_params: []
                ),
                start_val: object(1)
              )
            ]
          ),
          return_stmt(const_or_var(expr))
        ]
      ),
      res_type: type_ref(type_symbol(expr))
    ),
    syn_fn_def(
      name: fn_symbol(mk_and_clause),
      params: [
        (
          type: seq_type(
            nonempty: true,
            elem_type: type_ref(type_symbol(synclause))
          ),
          var: var(clauses)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(value: const_or_var(def_vars), var: var(vs)),
          assignment_stmt(value: seq_expr(head: []), var: var(cs)),
          for_stmt(
            body: [
              assignment_stmt(
                value: fn_call(
                  name: op_symbol(amp),
                  params: [
                    const_or_var(cs),
                    seq_expr(
                      head: [
                        fn_call(
                          name: fn_symbol(desugar_clause),
                          params: [const_or_var(c), const_or_var(vs)],
                          named_params: []
                        )
                      ]
                    )
                  ],
                  named_params: []
                ),
                var: var(cs)
              ),
              assignment_stmt(
                value: fn_call(
                  name: op_symbol(amp),
                  params: [
                    const_or_var(vs),
                    fn_call(
                      name: fn_symbol(syn_new_vars),
                      params: [const_or_var(c)],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                var: var(vs)
              )
            ],
            loops: [seq_iter(var: var(c), values: const_or_var(clauses))]
          ),
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(reverse),
              params: [const_or_var(cs)],
              named_params: []
            ),
            var: var(rev_cs)
          ),
          assignment_stmt(
            value: fn_call(
              name: op_symbol(brackets),
              params: [const_or_var(rev_cs), object(0)],
              named_params: []
            ),
            var: var(clause)
          ),
          for_stmt(
            body: [
              assignment_stmt(
                value: tag_obj_expr(
                  obj: map_expr(
                    {
                      (value: const_or_var(clause), key: object(right)),
                      (
                        value: fn_call(
                          name: op_symbol(brackets),
                          params: [const_or_var(rev_cs), const_or_var(i)],
                          named_params: []
                        ),
                        key: object(left)
                      )
                    }
                  ),
                  tag: object(and_clause)
                ),
                var: var(clause)
              )
            ],
            loops: [
              range_iter(
                var: var(i),
                end_val: fn_call(
                  name: op_symbol(minus),
                  params: [
                    fn_call(
                      name: fn_symbol(length),
                      params: [const_or_var(clauses)],
                      named_params: []
                    ),
                    object(1)
                  ],
                  named_params: []
                ),
                start_val: object(1)
              )
            ]
          ),
          return_stmt(const_or_var(clause))
        ]
      ),
      res_type: type_ref(type_symbol(clause))
    ),
    syn_fn_def(
      name: fn_symbol(replace_bound_vars),
      params: [
        (type: type_ref(type_symbol(pattern)), var: var(ptrn)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: replace_expr(
        ptrn: var_ptrn(
          name: var(p),
          ptrn: tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(var_ptrn)))
        ),
        expr: if_expr(
          else: const_or_var(p),
          branches: [
            (
              expr: tag_obj_expr(
                obj: accessor(expr: const_or_var(p), field: object(name)),
                tag: object(ext_var_ptrn)
              ),
              cond: fn_call(
                name: fn_symbol(in),
                params: [
                  accessor(expr: const_or_var(p), field: object(name)),
                  const_or_var(def_vars)
                ],
                named_params: []
              )
            )
          ]
        ),
        src_expr: const_or_var(ptrn)
      ),
      res_type: type_ref(type_symbol(pattern))
    ),
    syn_fn_def(
      name: fn_symbol(desugar_clause),
      params: [
        (type: type_ref(type_symbol(synclause)), var: var(clause)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(src)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(src)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(replace_bound_vars),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(ptrn)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(ptrn)
                  )
                }
              ),
              tag: object(in_clause)
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(in_clause)))
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(src)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(src)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(replace_bound_vars),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(ptrn)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(ptrn)
                  )
                }
              ),
              tag: object(not_in_clause)
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(not_in_clause))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(src)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(src)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(replace_bound_vars),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(value_ptrn)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(value_ptrn)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(replace_bound_vars),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(key_ptrn)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(key_ptrn)
                  )
                }
              ),
              tag: object(map_in_clause)
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(map_in_clause))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(src)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(src)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(replace_bound_vars),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(value_ptrn)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(value_ptrn)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(replace_bound_vars),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(key_ptrn)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(key_ptrn)
                  )
                }
              ),
              tag: object(map_not_in_clause)
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(map_not_in_clause))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assert_stmt(
                  not(
                    fn_call(
                      name: fn_symbol(in),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(var)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    )
                  )
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (
                          value: tag_obj_expr(
                            obj: map_expr(
                              {
                                (
                                  value: accessor(expr: const_or_var(clause), field: object(var)),
                                  key: object(name)
                                )
                              }
                            ),
                            tag: object(var_ptrn)
                          ),
                          key: object(ptrn)
                        ),
                        (
                          value: tag_obj_expr(
                            obj: set_expr(
                              {
                                fn_call(
                                  name: fn_symbol(desugar_expr),
                                  params: [
                                    accessor(expr: const_or_var(clause), field: object(expr)),
                                    const_or_var(def_vars)
                                  ],
                                  named_params: []
                                )
                              }
                            ),
                            tag: object(set_expr)
                          ),
                          key: object(src)
                        )
                      }
                    ),
                    tag: object(in_clause)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(eq_clause)))
            ]
          ),
          case(
            expr: fn_call(
              name: fn_symbol(mk_and_clause),
              params: [const_or_var(cs), const_or_var(def_vars)],
              named_params: []
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(cs)),
                tag: obj_ptrn(object(and_clause))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_clause),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(left)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(left)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_clause),
                      params: [
                        accessor(expr: const_or_var(clause), field: object(right)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(right)
                  )
                }
              ),
              tag: object(or_clause)
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(or_clause)))
            ]
          )
        ],
        exprs: [fn_par(0), fn_par(1)]
      ),
      res_type: type_ref(type_symbol(clause))
    ),
    syn_fn_def(
      name: fn_symbol(desugar_stmts),
      params: [
        (
          type: seq_type(nonempty: false, elem_type: type_ref(type_symbol(synstmt))),
          var: var(stmts)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(value: const_or_var(def_vars), var: var(vs)),
          assignment_stmt(value: seq_expr(head: []), var: var(ss)),
          for_stmt(
            body: [
              assignment_stmt(
                value: fn_call(
                  name: op_symbol(amp),
                  params: [
                    const_or_var(ss),
                    seq_expr(
                      head: [
                        fn_call(
                          name: fn_symbol(desugar_stmt),
                          params: [const_or_var(s), const_or_var(vs)],
                          named_params: []
                        )
                      ]
                    )
                  ],
                  named_params: []
                ),
                var: var(ss)
              ),
              assignment_stmt(
                value: fn_call(
                  name: op_symbol(amp),
                  params: [
                    const_or_var(vs),
                    fn_call(
                      name: fn_symbol(syn_new_vars),
                      params: [const_or_var(s)],
                      named_params: []
                    )
                  ],
                  named_params: []
                ),
                var: var(vs)
              )
            ],
            loops: [seq_iter(var: var(s), values: const_or_var(stmts))]
          ),
          return_stmt(const_or_var(ss))
        ]
      ),
      res_type: seq_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(statement))
      )
    ),
    syn_fn_def(
      name: fn_symbol(desugar_stmt),
      params: [
        (type: type_ref(type_symbol(synstmt)), var: var(stmt)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: match_expr(
        cases: [
          case(
            expr: tag_obj_expr(
              obj: map_expr(
                {
                  (
                    value: accessor(expr: const_or_var(stmt), field: object(var)),
                    key: object(var)
                  ),
                  (
                    value: fn_call(
                      name: fn_symbol(desugar_expr),
                      params: [
                        accessor(expr: const_or_var(stmt), field: object(value)),
                        const_or_var(def_vars)
                      ],
                      named_params: []
                    ),
                    key: object(value)
                  )
                }
              ),
              tag: object(assignment_stmt)
            ),
            patterns: [
              tag_ptrn(
                obj: type_ptrn(type_any),
                tag: obj_ptrn(object(assignment_stmt))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: fn_call(
                name: fn_symbol(desugar_expr),
                params: [const_or_var(e), const_or_var(def_vars)],
                named_params: []
              ),
              tag: object(return_stmt)
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(e)),
                tag: obj_ptrn(object(return_stmt))
              )
            ]
          ),
          case(
            expr: object(break_stmt),
            patterns: [obj_ptrn(object(break_stmt))]
          ),
          case(
            expr: object(fail_stmt),
            patterns: [obj_ptrn(object(fail_stmt))]
          ),
          case(
            expr: tag_obj_expr(
              obj: fn_call(
                name: fn_symbol(desugar_expr),
                params: [const_or_var(e), const_or_var(def_vars)],
                named_params: []
              ),
              tag: object(assert_stmt)
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(e)),
                tag: obj_ptrn(object(assert_stmt))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: fn_call(
                name: fn_symbol(desugar_expr),
                params: [const_or_var(e), const_or_var(def_vars)],
                named_params: []
              ),
              tag: object(print_stmt)
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(e)),
                tag: obj_ptrn(object(print_stmt))
              )
            ]
          ),
          case(
            expr: tag_obj_expr(
              obj: fn_call(
                name: fn_symbol(desugar_stmts),
                params: [const_or_var(ss), const_or_var(def_vars)],
                named_params: []
              ),
              tag: object(loop_stmt)
            ),
            patterns: [
              tag_ptrn(
                obj: var_ptrn(name: var(ss)),
                tag: obj_ptrn(object(inf_loop_stmt))
              )
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(desugar_stmts),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(else)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(res)
                ),
                for_stmt(
                  body: [
                    assignment_stmt(
                      value: fn_call(
                        name: fn_symbol(desugar_expr),
                        params: [
                          accessor(expr: const_or_var(b), field: object(cond)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      var: var(cond)
                    ),
                    assignment_stmt(
                      value: fn_call(
                        name: fn_symbol(desugar_stmts),
                        params: [
                          accessor(expr: const_or_var(b), field: object(body)),
                          const_or_var(def_vars)
                        ],
                        named_params: []
                      ),
                      var: var(body)
                    ),
                    assignment_stmt(
                      value: seq_expr(
                        head: [
                          tag_obj_expr(
                            obj: map_expr(
                              {
                                (value: const_or_var(cond), key: object(cond)),
                                (value: const_or_var(res), key: object(else)),
                                (value: const_or_var(body), key: object(body))
                              }
                            ),
                            tag: object(if_stmt)
                          )
                        ]
                      ),
                      var: var(res)
                    )
                  ],
                  loops: [
                    seq_iter(
                      var: var(b),
                      values: fn_call(
                        name: fn_symbol(reverse),
                        params: [
                          accessor(expr: const_or_var(stmt), field: object(branches))
                        ],
                        named_params: []
                      )
                    )
                  ]
                ),
                assert_stmt(
                  and(
                    left: membership(type: type_ref(type_symbol(seq)), obj: const_or_var(res)),
                    right: eq(
                      left: fn_call(
                        name: fn_symbol(length),
                        params: [const_or_var(res)],
                        named_params: []
                      ),
                      right: object(1)
                    )
                  )
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(brackets),
                    params: [const_or_var(res), object(0)],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(if_stmt)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: op_symbol(amp),
                    params: [
                      const_or_var(named_params),
                      fn_call(
                        name: fn_symbol(set),
                        params: [
                          seq_comp(
                            var: var(fd),
                            expr: tag_obj_expr(
                              obj: fn_call(
                                name: fn_symbol(untag),
                                params: [accessor(expr: const_or_var(fd), field: object(name))],
                                named_params: []
                              ),
                              tag: object(named_par)
                            ),
                            src_expr: accessor(expr: const_or_var(stmt), field: object(asgnms))
                          )
                        ],
                        named_params: []
                      )
                    ],
                    named_params: []
                  ),
                  var: var(nps)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(desugar_stmts),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(body)),
                      const_or_var(def_vars)
                    ],
                    named_params: [
                      syn_fn_def(
                        name: fn_symbol(named_params),
                        params: [],
                        local_fns: [],
                        expr: const_or_var(nps)
                      )
                    ]
                  ),
                  var: var(body)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(syn_fn_defs_to_named_params),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(asgnms)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(asgnms)
                ),
                return_stmt(
                  tag_obj_expr(
                    obj: map_expr(
                      {
                        (value: const_or_var(body), key: object(body)),
                        (value: const_or_var(asgnms), key: object(asgnms))
                      }
                    ),
                    tag: object(let_stmt)
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(let_stmt)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(desugar_expr),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(cond)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(cond)
                ),
                assignment_stmt(
                  value: tag_obj_expr(
                    obj: map_expr(
                      {
                        (value: seq_expr(head: []), key: object(else)),
                        (
                          value: seq_expr(head: [object(break_stmt)]),
                          key: object(body)
                        ),
                        (
                          value: tag_obj_expr(obj: const_or_var(cond), tag: object(not_expr)),
                          key: object(cond)
                        )
                      }
                    ),
                    tag: object(if_stmt)
                  ),
                  var: var(exit_stmt)
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(desugar_stmts),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(body)),
                      const_or_var(def_vars)
                    ],
                    named_params: []
                  ),
                  var: var(body)
                ),
                if_stmt(
                  else: [
                    assignment_stmt(
                      value: fn_call(
                        name: op_symbol(amp),
                        params: [
                          seq_expr(head: [const_or_var(exit_stmt)]),
                          const_or_var(body)
                        ],
                        named_params: []
                      ),
                      var: var(body)
                    )
                  ],
                  branches: [
                    (
                      cond: accessor(expr: const_or_var(stmt), field: object(skip_first)),
                      body: [
                        assignment_stmt(
                          value: fn_call(
                            name: op_symbol(amp),
                            params: [
                              const_or_var(body),
                              seq_expr(head: [const_or_var(exit_stmt)])
                            ],
                            named_params: []
                          ),
                          var: var(body)
                        )
                      ]
                    )
                  ]
                ),
                return_stmt(
                  tag_obj_expr(obj: const_or_var(body), tag: object(loop_stmt))
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(loop_stmt)))
            ]
          ),
          case(
            expr: do_expr(
              [
                assignment_stmt(
                  value: accessor(expr: const_or_var(stmt), field: object(loops)),
                  var: var(iters)
                ),
                assignment_stmt(value: const_or_var(def_vars), var: var(vs)),
                assignment_stmt(value: seq_expr(head: []), var: var(for_vs)),
                for_stmt(
                  body: [
                    assignment_stmt(
                      value: fn_call(
                        name: op_symbol(amp),
                        params: [
                          const_or_var(vs),
                          set_expr(
                            {
                              accessor(expr: const_or_var(it), field: object(var)),
                              cond_expr(
                                expr: accessor(expr: const_or_var(it), field: object(idx_var)),
                                cond: accessor_test(expr: const_or_var(it), field: object(idx_var))
                              )
                            }
                          )
                        ],
                        named_params: []
                      ),
                      var: var(vs)
                    ),
                    assignment_stmt(
                      value: fn_call(
                        name: op_symbol(amp),
                        params: [const_or_var(for_vs), seq_expr(head: [const_or_var(vs)])],
                        named_params: []
                      ),
                      var: var(for_vs)
                    )
                  ],
                  loops: [seq_iter(var: var(it), values: const_or_var(iters))]
                ),
                assignment_stmt(
                  value: fn_call(
                    name: fn_symbol(desugar_stmts),
                    params: [
                      accessor(expr: const_or_var(stmt), field: object(body)),
                      const_or_var(vs)
                    ],
                    named_params: []
                  ),
                  var: var(res)
                ),
                for_stmt(
                  body: [
                    assignment_stmt(
                      value: fn_call(
                        name: fn_symbol(rev_at),
                        params: [const_or_var(for_vs), const_or_var(i)],
                        named_params: []
                      ),
                      var: var(vs)
                    ),
                    if_stmt(
                      else: [
                        assert_stmt(
                          membership(
                            type: union_type(
                              {
                                tag_type(
                                  obj_type: type_ref(type_symbol(any)),
                                  tag_type: symb_type(object(range_iter))
                                )
                              }
                            ),
                            obj: const_or_var(it)
                          )
                        ),
                        assignment_stmt(
                          value: fn_call(
                            name: fn_symbol(desugar_expr),
                            params: [
                              accessor(expr: const_or_var(it), field: object(start_val)),
                              const_or_var(vs)
                            ],
                            named_params: []
                          ),
                          var: var(start_val)
                        ),
                        assignment_stmt(
                          value: fn_call(
                            name: fn_symbol(desugar_expr),
                            params: [
                              accessor(expr: const_or_var(it), field: object(end_val)),
                              const_or_var(vs)
                            ],
                            named_params: []
                          ),
                          var: var(end_val)
                        ),
                        assignment_stmt(
                          value: seq_expr(
                            head: [
                              tag_obj_expr(
                                obj: map_expr(
                                  {
                                    (value: const_or_var(res), key: object(body)),
                                    (value: const_or_var(end_val), key: object(end_val)),
                                    (value: const_or_var(start_val), key: object(start_val)),
                                    (
                                      value: accessor(expr: const_or_var(it), field: object(var)),
                                      key: object(var)
                                    )
                                  }
                                ),
                                tag: object(for_stmt)
                              )
                            ]
                          ),
                          var: var(res)
                        )
                      ],
                      branches: [
                        (
                          cond: membership(
                            type: union_type(
                              {
                                tag_type(
                                  obj_type: type_ref(type_symbol(any)),
                                  tag_type: symb_type(object(seq_iter))
                                )
                              }
                            ),
                            obj: const_or_var(it)
                          ),
                          body: [
                            assignment_stmt(
                              value: fn_call(
                                name: fn_symbol(desugar_expr),
                                params: [
                                  accessor(expr: const_or_var(it), field: object(values)),
                                  const_or_var(vs)
                                ],
                                named_params: []
                              ),
                              var: var(vals)
                            ),
                            assignment_stmt(
                              value: seq_expr(
                                head: [
                                  tag_obj_expr(
                                    obj: map_expr(
                                      {
                                        (value: const_or_var(res), key: object(body)),
                                        (value: const_or_var(vals), key: object(values)),
                                        (
                                          value: accessor(expr: const_or_var(it), field: object(var)),
                                          key: object(var)
                                        ),
                                        (
                                          value: accessor(expr: const_or_var(it), field: object(idx_var)),
                                          cond: accessor_test(expr: const_or_var(it), field: object(idx_var)),
                                          key: object(idx_var)
                                        )
                                      }
                                    ),
                                    tag: object(foreach_stmt)
                                  )
                                ]
                              ),
                              var: var(res)
                            )
                          ]
                        )
                      ]
                    )
                  ],
                  loops: [
                    seq_iter(
                      var: var(it),
                      values: fn_call(
                        name: fn_symbol(reverse),
                        params: [const_or_var(iters)],
                        named_params: []
                      ),
                      idx_var: var(i)
                    )
                  ]
                ),
                assert_stmt(
                  and(
                    left: membership(type: type_ref(type_symbol(seq)), obj: const_or_var(res)),
                    right: eq(
                      left: fn_call(
                        name: fn_symbol(length),
                        params: [const_or_var(res)],
                        named_params: []
                      ),
                      right: object(1)
                    )
                  )
                ),
                return_stmt(
                  fn_call(
                    name: op_symbol(brackets),
                    params: [const_or_var(res), object(0)],
                    named_params: []
                  )
                )
              ]
            ),
            patterns: [
              tag_ptrn(obj: type_ptrn(type_any), tag: obj_ptrn(object(for_stmt)))
            ]
          )
        ],
        exprs: [fn_par(0), fn_par(1)]
      ),
      res_type: type_ref(type_symbol(statement))
    ),
    syn_fn_def(
      name: fn_symbol(syn_fn_defs_to_named_params),
      params: [
        (
          type: seq_type(
            nonempty: false,
            elem_type: type_ref(type_symbol(synfndef))
          ),
          var: var(fds)
        ),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: map_comp(
        sel_exprs: [],
        source: [
          in_clause(
            src: fn_call(
              name: fn_symbol(set),
              params: [const_or_var(fds)],
              named_params: []
            ),
            ptrn: var_ptrn(name: var(fd))
          )
        ],
        value_expr: fn_call(
          name: fn_symbol(syn_fn_def_to_expr),
          params: [const_or_var(fd), const_or_var(def_vars)],
          named_params: []
        ),
        key_expr: tag_obj_expr(
          obj: fn_call(
            name: fn_symbol(untag),
            params: [accessor(expr: const_or_var(fd), field: object(name))],
            named_params: []
          ),
          tag: object(named_par)
        )
      ),
      res_type: map_type(
        value_type: type_ref(type_symbol(extexpr)),
        key_type: union_type(
          {
            tag_type(
              obj_type: type_ref(type_symbol(atom)),
              tag_type: symb_type(object(named_par))
            )
          }
        )
      )
    ),
    syn_fn_def(
      name: fn_symbol(syn_fn_def_to_expr),
      params: [
        (type: type_ref(type_symbol(synfndef)), var: var(fd)),
        (
          type: set_type(nonempty: false, elem_type: type_ref(type_symbol(var))),
          var: var(def_vars)
        )
      ],
      local_fns: [],
      expr: do_expr(
        [
          assignment_stmt(
            value: seq_comp(
              var: var(p),
              expr: accessor(expr: const_or_var(p), field: object(var)),
              src_expr: accessor(expr: const_or_var(fd), field: object(params))
            ),
            var: var(ps)
          ),
          assignment_stmt(
            value: fn_call(
              name: fn_symbol(desugar_expr),
              params: [
                accessor(expr: const_or_var(fd), field: object(expr)),
                fn_call(
                  name: op_symbol(amp),
                  params: [
                    const_or_var(def_vars),
                    fn_call(
                      name: fn_symbol(set),
                      params: [const_or_var(ps)],
                      named_params: []
                    )
                  ],
                  named_params: []
                )
              ],
              named_params: []
            ),
            var: var(expr)
          ),
          if_stmt(
            else: [],
            branches: [
              (
                cond: neq(
                  left: accessor(expr: const_or_var(fd), field: object(params)),
                  right: seq_expr(head: [])
                ),
                body: [
                  assignment_stmt(
                    value: tag_obj_expr(
                      obj: map_expr(
                        {
                          (value: const_or_var(expr), key: object(expr)),
                          (value: const_or_var(ps), key: object(params))
                        }
                      ),
                      tag: object(cls_expr)
                    ),
                    var: var(expr)
                  )
                ]
              )
            ]
          ),
          return_stmt(const_or_var(expr))
        ]
      ),
      res_type: type_ref(type_symbol(extexpr))
    )
  ],
  signatures: [
    syn_sgn(
      name: fn_symbol(named_params),
      params: [],
      res_type: set_type(
        nonempty: false,
        elem_type: union_type(
          {
            tag_type(
              obj_type: type_ref(type_symbol(atom)),
              tag_type: symb_type(object(named_par))
            )
          }
        )
      )
    ),
    syn_sgn(
      name: fn_symbol(local_fns),
      params: [],
      res_type: set_type(
        nonempty: false,
        elem_type: type_ref(type_symbol(basicuntypedsgn))
      )
    ),
    syn_sgn(
      name: fn_symbol(curr_outer_fn),
      params: [],
      res_type: type_ref(type_symbol(fnsymbol))
    )
  ]
)
